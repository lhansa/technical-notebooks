{
  "hash": "a18b197cf4eb5dbb874a899f1439ec96",
  "result": {
    "markdown": "---\ntitle: \"Cómo interpretas un intervalo de confianza\"\ndescription: \"Cómo calcular e interpretar intervalos de confianza\"\ndescription-meta: \"Cómo calcular e interpretar intervalos de confianza.\"\nauthor: \"Leonardo Hansa\"\ndate: \"2023-11-11\"\ncategories: [datos]\nexecute: \n  echo: false\nfreeze: auto\n---\n\n\nCreo que no entendí qué eran los intervalos de confianza en ninguna clase de estadística.\n\nA ver, no digo que no me los explicaran. \n\nDigo que, pese a que me los explicaron, no entendí nada de ellos. \n\nEn el mundo laboral me encuentro con dos situaciones contradictorias: \n\n- Hay personas que defienden que todas las estimaciones que se dan deberían incluir los intervalos de confianza. \n- Pero hay personas, normalmente los consumidores o clientes de esas estimaciones, que no tienen ni idea de qué es un intervalo de confianza. \n\nY no digo que sea culpa suya. \n\nLa verdad, con lo complicado que es el concepto (porque no tiene ni pies ni cabeza) y lo mal que lo dan, normal que no se enteren. \n\n¿Se deberían dar los intervalos de confianza? Pues dado que algo de la incertidumbre de tus estimaciones deberías dar, mientras no tengas nada mejor, sí, deberías darlos. \n\nTe muestro aquí un ejemplo de **cómo se interpretan.**\n\n\n## Cálculo del intervalo\n\nVoy a usar un ejemplo muy concreto. \n\n¿Significa eso que lo que te voy a explicar solo sirve para este ejemplo?\n\nNo, es extrapolable. Pero necesito un ejemplo concreto porque si no, pasa lo de siempre: que nadie se entera de nada. \n\nEl ejemplo es **estimar la media de una población a partir de la media de una muestra.** Parece una bobada, lo sé, pero verás en breve que hay cierta incertidumbre al usar la media muestral para esto. \n\nCon esto no digo que no uses la media muestral. Lo que digo es que seas consciente de que hay cierta incertidumbre. \n\nPara jugar con esta incertidumbre, voy a recrear un ejemplo del que conozco la media poblacional, y veremos qué tal se comporta la media muestra. \n\nUso una población de distribución **normal de media 1000 y desviación típica 100**. ¿Lo puedes hacer con otros números? Sí, claro. Ya te he dicho que esto es extrapolable a cualquier cosa de estimación. \n\nVoy a tomar una muestra de tamaño 100 de esta población. Y calculo la media y desviación típica. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(3718)\nsample_size <- 100\npopulation_mean <- 1000\npopulation_sd <- 100\n\nnorm_values <- rnorm(sample_size, population_mean, population_sd)\n\nsample_mean <- mean(norm_values)\n```\n:::\n\n\nLa media muestral es 1007.718297. \n\nEl objetivo de estos párrafos es calcular el intervalo de confianza para esa estimación, o sea, a la hora de usar la media muestral como estimación de la media poblacional. \n\nPara ello necesitamos la media y **desviación típica poblacional**[^1] (las tenemos), el tamaño muestral (me lo he inventado yo, 100). \n\n[^1 Si no tienes la poblacional y usas una muestral necesitas hacer un ajuste en lo que voy a contar hoy. Te lo cuento otro día.]\n\nY necesitamos también los valores de la distribución normal que delimitan la confianza al nivel que queramos (95% para no salir de lo habitual). En R lo puedes calcular con `qnorm(0.975)` y `qnorm(0.025)`.\n\nEl intervalo estará centrado en tu media muestral. Las cotas vendrán dadas por un margen de error. \n\nEste margen de error se calcula con: \n\n- La desviación típica **poblacional.**\n- La raíz cuadrada del tamaño muestral.\n- Un valor que ahora te explico.\n\nLa desviación típica de la muestra dividida por la raíz cuadrada del tamaño muestral no es un valor cualquiera. Es **la desviación típica de la media muestral.** \n\nO sea, tienes una población, y tomas una muestra; con esa muestra te calculas la media y te la guardas. Ahora tomas otra muestra, vuelves a calcular la media y te la guardas. Y así muchas veces. Todas estas medias no serán iguales entre sí: serán parecidas, y deberían estar cerca de la media poblacional, pero varían. Varían con una desviación típica. ¿Cuál? Ese valor que hemos dicho. \n\nMira. \n\nVoy a calcular 1000 medias muestrales de diferentes muestras de tamaño 100 y calculo su desviación típica. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmuchas_medias <- replicate(1000, {\n  mean(rnorm(sample_size, population_mean, population_sd))\n})\n\nsd(muchas_medias)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10.00571\n```\n:::\n:::\n\n\nY ahora lo comparo con la división de la desviación típica de la población entre la raíz cuadrada del tamaño muestral: 10. ¿A que se parecen bastante?\n\nPero el margen de error no depende solo de eso, sino que falta el numerito extra. O sea, tiene sentido que el margen de error dependa de la desviación típica de lo que estás estimando, pero falta lo de la _confianza_. Si quieres mucha confianza, tendrás que aumentar de alguna forma el margen de error; y si quieres menos confianza, tendrás que reducirlo. \n\nPara eso necesitas el estadístico $z$. Nos interesa el intervalo de confianza al 95%, ¿no? Pues este valor $z$ lo puedes ver como el valor de la distribución normal $\\mathcal{N}(0, 1)$ que deja a su izquierda el 95% de la probabilidad. O sea, los números mayores que él, solo aparecerán en una distribución normal con un 5% de probabilidad. \n\nAl multiplicar este valor por la desviación típica de la media muestral, lo que estás haciendo es llevar el margen de error a la escala de tu población (y no dejarla en la de una normal 0-1). \n\nPues ahora ya está todo. \n\nSi eres alguien anclado en el siglo XX, buscarás el valor de $z$ en una tabla. Si vives en el presente, usarás algún software que te lo busque. \n\nEn R puedes usar la función `qnorm()`. \n\nQuieres el 95% de probabilidad, pero ten en cuenta que la distribución normal es simétrica. Así que necesitas el extremo que deje el 2.5% a su derecha y el que deje el 2.5% a su izquierda. Lo puedes hacer con `qnorm(c(0.025, 0.975))`.\n\n\n::: {.cell}\n\n:::\n\n\nEl resultado es que el intervalo es (988.1186572, 1027.3179369).\n\nSi tienes en cuenta que la media poblacional era 1000, no es una estimación horrible.\n\nPero...\n\n## Interpretación del intervalo\n\n¿Cómo interpretas esos valores? La interpretación **no** es que el valor de la media poblacional está ahí dentro con un 95% de probabilidad. \n\nLa media poblacional es un dato, es una realidad. No sabemos si está dentro o no, pero no hay una probabilidad para indicar dónde está. \n\nVamos a ver cómo se interpreta.\n\nEn lugar de dar la definición formal de intervalo de confianza, que no hay dios que la entienda, vamos a construir muchos intervalos de confianza. \n\n\n::: {.cell}\n\n:::\n\n\nConstruyo 10^{4} intervalos de confianza, cada uno a partir de una muestra diferente, pero todas provenientes de la misma población. \n\nCada muestra tendrá una media, que aprovecho y calculo también.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(purrr)\nexperiments <- map(seq_len(computations), function(i) {\n  compute_interval(sample_size, population_mean, population_sd) \n})\n```\n:::\n\n\nFíjate en el siguiente gráfico. Ha habido muestras cuya media muestral ha sido cercana a 960 ó a 1040. Y esas muestras tendrán sus intervalos de confianza centrados en ese valor... tiene pinta de que van a estar lejos de la media poblacional. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/sample-mean-distribution-1.png){width=672}\n:::\n:::\n\nDe esos experimentos que hemos hecho, podemos extraer también los intervalos de confianza. Voy a pintártelos para que veas dónde han caído. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot-confints-1.png){width=672}\n:::\n:::\n\n\nToda esa banda morada son los 10^{4} intervalos de confianza calculados. La línea amarilla realmente es una sucesión de puntos (como todas las líneas) con cada media muestral. \n\nLa línea negra es la media poblacional. Y fíjate en que hay unos pocos intervalos (los de más abajo y los de más arriba, los extremos) que no tocan esa línea negra. O sea, **hay intervalos que no contienen a la media poblacional.**\n\nEsto es muy fuerte. \n\nAl principio he tomado una muestra, he calculado la media muestral como estimación de la poblacional, y en torno a ella he construido un intervalo de confianza. \n\nEse intervalo era un posible intervalo de confianza al 95% por ciento. Y en ese caso sí contenía a la media poblacional (cosa que sé porque estoy en un experimento controlado, pero lo normal es que no sepas la media poblacional). \n\n**Pero si me hubiera salido como muestra una diferente, podría haber ocurrido que el intervalo no hubiera contenido a la media poblacional.**\n\nMuy fuerte esto. \n\nPero la pregunta que surge ahora es: **¿cuántos intervalos no contienen a la media poblacional?**\n\nPues aquí entra el 95%. \n\n### El 95% de los intervalos de confianza al 95% contienen la media poblacional\n\nA continuación calculo el porcentaje de intervalos que sí contienen a la media poblacional, teniendo en cuenta a los 10^{4} que he calculado. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9519\n```\n:::\n:::\n\n\nMe sale que el 95,19% de los intervalos calculados contienen a la media poblacional. \n\nEso es lo que quiere decir que tengas un intervalo de confianza al 95%. Significa que, de todos los intervalos que puedes calcular, el 95% tendrá al parámetro real. Pero el tuyo no sabes si está en ese 95% o no lo está (repito, en este experimento sí sabemos si está en ese porcentaje porque es un experimento controlado pero normalmente no lo sabes). \n\nDe hecho, puedo cambiar el nivel de confianza, y el porcentaje cambiará acorde a ello: \n\n**Confianza al 99%**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n    pct\n  <dbl>\n1 0.990\n```\n:::\n:::\n\n\n**Confianza al 80%**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n    pct\n  <dbl>\n1 0.803\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}