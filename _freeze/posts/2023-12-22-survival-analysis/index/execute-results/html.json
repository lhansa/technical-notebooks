{
  "hash": "0f0ca40abf97030a5196c6ef5a636cf9",
  "result": {
    "markdown": "---\ntitle: \"Introducción a análisis de supervivencia con R\"\ndescription: \"Ejemplo de introducción al análisis de supervivencia con R\"\ndescription-meta: \"Ejemplo de introducción al análisis de supervivencia con R\"\nauthor: \"Leonardo Hansa\"\ndate: \"2023-12-22\"\ncategories: [datos]\nexecute: \n  echo: false\nfreeze: auto\n---\n\n\nEl nombre del análisis de supervivencia apunta maneras. Inevitablemente, yo lo relaciono con la muerte, porque seguramente se originara para saber cuánto tiempo le quedaba de vida a un paciente con alguna enfermedad. \n\nPero no sirve solo para eso. \n\nAlgunos ejemplos de casos que puedes resolver con análisis de supervivencia son: \n\n- ¿Cuál es la probabilidad de que un paciente con cáncer de mama viva más de 5 años?\n- ¿Cuál es el tiempo de espera típico cuando llamas a un taxi?\n- De 100 parados, ¿cuántos esperas que encuentren trabajo pasados 2 meses?\n\n## Teoría del análisis de supervivencia\n\nLos modelos de supervivencia buscan modelizar la función de supervivencia, dada por esta ecuación: \n\n$$S(t) = 1 - F(t) = P(T > t)$$\n\nViene a interpretarse como **la probabilidad de que la duración del experimento sea mayor de $t$**. $F(t)$ representa la función de distribución del evento. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/surv-func-1.png){width=672}\n:::\n:::\n\nEsa gráfica ya daría algo de información. Por ejemplo: \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n- Sabemos que la probabilidad de la probabilidad de superar el instante $t = 3$ es de 0,97. \n- Sabemos que el tercer cuartil es 5,65.\n \n **El objetivo del análisis de supervivencia es estimar esta función de supervivencia.**\n\n## El método Keplen-Meier para estimar la función de supervivencia\n\nLa fórmula que usa este método para estimar la función de supervivencia en $t$ es: \n\n$$S(t) = \\prod_{i: t_i\\leq t}\\frac{n_i - d_i}{n_i}$$\n\ndonde $t_i$ representa a cada uno de los instantes anteriores al instante $t$, $n_i$ es el número de individuos en $t_i$ y $d_i$ es el número de defunciones en $t_i$. \n\nLo podemos ver mejor con numeritos y este gráfico: \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n$$\n\\hat{S}(t) =  \\prod_{i: t_i\\leq t}\\frac{n_i - d_i}{n_i} \\\\\n$$\n$$\n\\hat{S}(2) = \\frac{5-0}{5} = \\frac{5}{5} = 1 \\\\\n$$\n$$\n\\hat{S}(3) = \\frac{4-0}{4} = \\frac{4}{4} = 1 \\\\\n$$\n$$\n\\hat{S}(4) = \\frac{4-2}{4} = \\frac{2}{4} = 0,5 \\\\\n$$\n$$\n\\hat{S}(5) = \\frac{1}{2} \\cdot \\frac{2-1}{2} = \\frac{1}{4} = 0,25 \\\\\n$$\n$$\n\\hat{S}(6) = \\frac{1}{4} \\cdot \\frac{1-0}{1} = \\frac{1}{4} = 0,25 \n$$\n\nAunque después de avanzar un poco con el curso, me entero de que Keplen-Meier se usa principalmente con fines descritivos.\n\n## Método Weibull\n\nUn método que sí se usa para estimar la curva es el de Weibull. Sinceramente, **ni idea de cómo funciona.**\n\nPero una forma directa de ajustar y visualizarlo es esta (para visualizar simplifica mucho si usas la librería **survminer**):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\nwb <- survreg(Surv(time, status) ~ 1, lung)\n# Retrieve survival curve from model\nsurv <- seq(.99, .01, by = -.01)\n\n# Get time for each probability\nt <- predict(wb, type = \"quantile\", p = 1 - surv, newdata = data.frame(1))\n\n# Create data frame with the information needed for ggsurvplot_df\nsurv_wb <- data.frame(time = t, surv = surv, \n  upper = NA, lower = NA, std.err = NA)\n\n# Plot\n\nsurvminer::ggsurvplot_df(fit = surv_wb, surv.geom = ggplot2::geom_line)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/weibull-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}