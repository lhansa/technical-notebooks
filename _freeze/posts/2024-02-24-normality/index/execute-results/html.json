{
  "hash": "8a8d1948e41149ebccfcaaa90967de06",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"¿Cómo surge la distribución normal?\"\ndescription: \"Exploración de la distribución normal con R\"\ndescription-meta: \"Exploración de la distribución normal con R\"\nauthor: \"Leonardo Hansa\"\ndate: \"2024-02-24\"\ncategories: [datos]\nexecute: \n  echo: true\nfreeze: auto\n---\n\n\n\nLa distribución normal siempre me ha parecido demasiado perfecta para esperar verla en unos datos reales. \n\nPero claro, eso me pasa por no saber de dónde viene. \n\nTe cuento. \n\nImagina un grupo de personas que parten de una línea. Cada uno lanza una moneda al aire; si sale cara, da un paso a la izquierda, de máximo 1 metro; si no, lo da a la derecha. Los pasos estarán entre 0 y 1 metro. Al cabo de 16 lanzamientos, ¿a qué distancia estará del origen?\n\nSerá la suma de las distancias de esos pasos.\n\nPodemos calcular esto para 1000 personas.\n\nPrimero si dan 4 pasos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npos <- replicate(1000, sum(runif(4, -1, 1)))\nhist(pos)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/pasos4-1.png){width=672}\n:::\n:::\n\n\n\nAhora si dan 8 pasos:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npos <- replicate(1000, sum(runif(8, -1, 1)))\nhist(pos)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/pasos8-1.png){width=672}\n:::\n:::\n\n\n\nAhora si dan 16:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npos <- replicate(1000, sum(runif(16, -1, 1)))\nhist(pos)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/pasos16-1.png){width=672}\n:::\n:::\n\n\n\nRealmente, casi con cualquier distribución puedes hacer esto. La suma de valores de cualquier distribución seguirá una distribución normal (con algunas necesitarás una muestra más grande que con otras).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(replicate(1000, sum(rpois(100, 2))))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/suma-pois-1.png){width=672}\n:::\n:::\n\n\n\n\n## Ejemplo de modelo basado en la normalidad\n\nLa altura de varias personas adultas es esperable que se distribuya como una distribución normal. \n\nLa idea intuitiva es que la altura de una persona adulta es el resultado de muchos pequeños aumentos que se suman. Para distintos individuos, estas sumas darán resultados distintos, porque los aumentos progresivos entre ellos serán distintos al cabo de los años. Pero el conjunto de todas ellas será normal, si has esperado suficientes años para que los casos más altos (aumentos más grandes acumulados) se compensen con los más bajos (aumentos más pequeños). \n\nVamos a trabajar con una muestra de personas, de las que conocemos su altura. \n\nQueremos modelizar la altura como una distribución normal, o sea, estimaremos la media y desviación típica. \n\nEl método bayesiano considerará todas las medias y desviaciones típicas posibles (realmente haremos una aproximación), y evaluaremos cada una en función de cómo de plausibles son, dados los datos que tenemos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rethinking)\n\ndata(Howell1)\nhead(Howell1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   height   weight age male\n1 151.765 47.82561  63    1\n2 139.700 36.48581  63    0\n3 136.525 31.86484  65    0\n4 156.845 53.04191  41    1\n5 145.415 41.27687  51    0\n6 163.830 62.99259  35    1\n```\n\n\n:::\n:::\n\n\n\nPor ahora, vamos a centrarnos solo en los casos adultos, porque la altura de los niños no se distribuye normalmente, sino que está correlada con la edad. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadultos <- Howell1[Howell1$age > 18, ]\n\nhist(adultos$height, col = \"#800080\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nQueremos modelizar la altura $h_i$ de cada individuo $i$ como $h_i \\sim \\cal{N}(\\mu, \\sigma)$. **El objetivo es estimar** $\\mu$ y $\\sigma$.\n\n\nComo estamos en un modelo bayesiano, necesitamos unos prioris para ambos parámetros. Los prioris son distribuciones de estos parámetros que consideramos razonables. \n\n$$\nh_i \\sim \\cal{N}(\\mu, \\sigma)\n\\\\\n\\mu \\sim \\cal{N}(178, 20)\n\\\\\n\\sigma \\sim \\cal{U}(0, 50)\n$$\n\nEstamos dando como distribución a priori de la media una normal centrada en $\\cal{178}$ y con un rango de $\\cal{40}$cm con una probablidad de 95%. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncurve(dnorm(x, 178, 20), from = 100, to = 250, col = \"#800080\", lwd = 2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/howell1-priori-1.png){width=672}\n:::\n:::\n\n\n\nLa priori sobre la desviación típica es plana, en el sentido de que no sabemos dar más importancia a unos valores frente a otros, dentro los propuestos en el intervalo de la uniforme. \n\nPodemos simular cómo serían unos datos a partir de estas prioris. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_mu <- rnorm(1e4, 178, 20)\nsample_sigma <- runif(1e4, 0, 50)\n\nprior_h <- rnorm(1e4, sample_mu, sample_sigma)\nhist(prior_h, col = \"#800080\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/simulacion-prioris-1.png){width=672}\n:::\n:::\n\n\n\nLo que hemos hecho es simular 10.000 pares de $\\mu$ y $\\sigma$ y para cada par hemos simulado una altura. Así tenemos 10.000 alturas, cada una originada a partir de una población normal distinta (pero todas las poblaciones normales son tan plausibles como indica nuestra priori). \n\n\nSi cambiáramos la priori, la simulación a priori de la altura se vería afectada: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_mu <- rnorm(1e4, 178, 100)\n\nprior_h <- rnorm(1e4, sample_mu, sample_sigma)\nhist(prior_h, col = \"#800080\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/simulacion-prioris2-1.png){width=672}\n:::\n:::\n\n\n\nEsa es una priori menos informativa, con una media mucho más dispersa. Pero puedes ver que las alturas que derivarían de unas prioris así no son realistas, dado que hay casos de altura negativa o también demasiado altos. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_altura <- quap( \n  alist(\n    height ~ dnorm( mu , sigma ) ,\n    mu ~ dnorm( 178 , 20 ) ,\n    sigma ~ dunif( 0 , 50 )\n  ), \n  data = adultos\n)\n\nprecis(fit_altura)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            mean        sd       5.5%      94.5%\nmu    154.654539 0.4172190 153.987743 155.321336\nsigma   7.762397 0.2950864   7.290792   8.234002\n```\n\n\n:::\n:::\n\n\nObtenemos un modelo normal con una media cuya media es 154 y su desviación típica es 0.42. Sí, el resultado de para la media de de la población es una distribución: no conocemos el valor exacto de la media sino que hemos estimado la distribución a la que pertenece. \n\nLo mismo con la desviación típica.\n\nConcretamente, esta distribución de la **media** es la que muestra este histograma.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nposterior_h <- extract.samples(fit_altura, n = 1e4)\nhist(posterior_h$mu, col = \"#800080\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/altura-posteriori-1.png){width=672}\n:::\n:::\n\n\n\n### Ajuste de prioris\n\nLa priori no informativa que sugerimos antes no tenía sentido porque daba lugar a valores de alturas inhumanas, como negativos o demasiados altos. \n\nPodemos proponer también una priori más restrictica. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsample_mu <- rnorm(1e4, 178, 0.1)\n\nprior_h <- rnorm(1e4, sample_mu, sample_sigma)\nhist(prior_h, col = \"#800080\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/prioris-ajustadas-1.png){width=672}\n:::\n:::\n\n\n\nEsta priori fuerza a la media a quedarse mucho más centrada en la media propuesta.  Y esto cambia el modelo. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_altura2 <- quap(\n  alist(\n    height ~ dnorm(mu, sigma), \n    mu ~ dnorm(178, 0.1), \n    sigma ~ dunif(0, 50)\n  ), \n  data = adultos\n)\n\nprecis(fit_altura2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           mean        sd      5.5%     94.5%\nmu    177.86598 0.1002314 177.70579 178.02617\nsigma  24.48463 0.9356079  22.98935  25.97991\n```\n\n\n:::\n:::\n\n\n\nLa media $\\mu$ apenas se ha movido del prior ahora. Sin embargo, el valor de $\\sigma$ ha cambiado mucho porque el modelo lo calcula condicionada a la restricción del otro parámetro.\n\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}