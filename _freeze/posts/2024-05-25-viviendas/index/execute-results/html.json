{
  "hash": "cb8c98b5b6f866461a8d31d41944e6aa",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Evolución de compraventa mensual en España\"\ndescription: \"Evolución de compraventa mensual en España\"\ndescription-meta: \"Evolución de compraventa mensual en España\"\nauthor: \"Leonardo Hansa\"\ndate: \"2024-05-25\"\ncategories: [datos]\nexecute: \n  echo: true\n  message: false\n  warning: false\nfreeze: true\n---\n\n\n\n\nEl INE tiene datos mensuales sobre compraventa de viviendas por Comunidades Autónomas (lo tiene por provincias pero he pasado de ese nivel):\n\n::: {#cell-lectura .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\n\ndf_viviendas = pd.read_csv(\n  'ine-compraventa.csv', \n  sep=';', \n  thousands='.',\n  encoding='iso-8859-1'\n)\n\ndf_viviendas = (\n  df_viviendas\n  .drop(['Régimen y estado', 'Total Nacional', 'Provincias'], axis=1)\n  .rename(\n    columns=lambda x: x.lower().replace(' ', '_').encode('ascii', 'ignore').decode('utf-8'))\n)\n\ndf_viviendas.head()\n```\n\n::: {#lectura .cell-output .cell-output-display execution_count=1}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>comunidades_y_ciudades_autnomas</th>\n      <th>periodo</th>\n      <th>total</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>01 Andalucía</td>\n      <td>2024M03</td>\n      <td>8805</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>01 Andalucía</td>\n      <td>2024M02</td>\n      <td>9606</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>01 Andalucía</td>\n      <td>2024M01</td>\n      <td>10290</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>01 Andalucía</td>\n      <td>2023M12</td>\n      <td>7519</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>01 Andalucía</td>\n      <td>2023M11</td>\n      <td>9857</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nVamos a tratarlo un poco (tampoco mucho, que es sábado):\n\n::: {#cell-algo-tratamiento .cell execution_count=2}\n``` {.python .cell-code}\ndf_viviendas['periodo'] = pd.to_datetime(df_viviendas['periodo'], format='%YM%m')\n\ndf_viviendas['comunidades_y_ciudades_autnomas'] = df_viviendas['comunidades_y_ciudades_autnomas'].str.replace(r'\\d{2} ', '', regex=True)\n\n\ndf_viviendas = (\n  df_viviendas\n  .rename(columns={'comunidades_y_ciudades_autnomas': 'ccaa'})\n)\n\ndf_viviendas.head()\n```\n\n::: {#algo-tratamiento .cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ccaa</th>\n      <th>periodo</th>\n      <th>total</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Andalucía</td>\n      <td>2024-03-01</td>\n      <td>8805</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Andalucía</td>\n      <td>2024-02-01</td>\n      <td>9606</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Andalucía</td>\n      <td>2024-01-01</td>\n      <td>10290</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Andalucía</td>\n      <td>2023-12-01</td>\n      <td>7519</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Andalucía</td>\n      <td>2023-11-01</td>\n      <td>9857</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nMucho mejor. Ahora toca visualizar esto. \n\nEl siguiente código es de ChatGPT... y sinceramente, creo que está mal, que pinta lo que le da la gana y no lo que yo quiero (concretamente, se inventa el orden del eje x).\n\nPero llevo horas con problemas de VSCode, versiones de Python, entornos virtuales y paso de dedicarle más tiempo a esto hoy (cosa que en R habrían sido 5 minutos). \n\nOtro día.\n\n::: {#cell-evolucion .cell execution_count=3}\n``` {.python .cell-code}\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport matplotlib.dates as mdates\n\ng = sns.FacetGrid(\n  df_viviendas, \n  col='ccaa', \n  col_wrap=5, \n  hue='ccaa', \n  sharey=False,\n)  \n\ng.map_dataframe(sns.lineplot, x='periodo', y='total')\n\n# Ajustar las etiquetas y el layout\nfor ax in g.axes.flatten():\n    # Ajustar los locators para que solo se muestren unos pocos ticks\n    ax.xaxis.set_major_locator(mdates.MonthLocator(interval=12))  # Ajusta el intervalo según sea necesario\n    ax.xaxis.set_major_formatter(mdates.DateFormatter('%Y-%m'))\n    ax.tick_params(axis='x', rotation=45)\n\ng.set_axis_labels('Fecha', 'Total')\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/evolucion-output-1.png){#evolucion width=1441 height=1179}\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}