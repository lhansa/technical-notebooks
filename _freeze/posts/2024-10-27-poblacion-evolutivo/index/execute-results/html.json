{
  "hash": "113fcc63bac00b77dc7544098d2a14a7",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Evolución de la población por provincias en España\"\ndescription: \"Exploratorio con Python de los datos públicos de residentes por provincia en España\"\ndescription-meta: \"Exploratorio con Python de los datos públicos de residentes por provincia en España\"\nauthor: \"Leonardo Hansa\"\ndate: \"2024-10-27\"\ncategories: [exploraciones]\nexecute: \n  echo: true\n  message: false\n  warning: false\nfreeze: true\n---\n\n\nEl INE tiene datos de evolución ~~trimestral~~ semestral de la población por provincias en España. \n\nEn un formato horrible, por supuesto.\n\n::: {#libs .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport locale\n```\n:::\n\n\n::: {#cell-read-data .cell execution_count=2}\n``` {.python .cell-code}\nlocale.setlocale(locale.LC_TIME, 'es_ES.UTF-8')\n\ndf_ine = pd.read_csv(\n    'ine-poblacion-provincias.csv', \n    sep=';', \n    header=0, \n    names=['edad', 'provincia', 'sexo', 'periodo', 'residentes']\n    # usecols=['provincia', 'periodo', 'residentes']\n)\n\ncondicion = (df_ine['edad'] == 'Todas las edades') & (df_ine['sexo'] == 'Total')\ndf_ine = df_ine.loc[condicion, ['provincia', 'periodo', 'residentes']]\n\ndf_ine['residentes'] = pd.to_numeric(df_ine['residentes'].str.replace('.',''))\ndf_ine['periodo'] = pd.to_datetime(df_ine['periodo'], format='%d de %B de %Y')\n\ndf_ine.head()\n```\n\n::: {#read-data .cell-output .cell-output-display execution_count=10}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>provincia</th>\n      <th>periodo</th>\n      <th>residentes</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>Total Nacional</td>\n      <td>2023-01-01</td>\n      <td>48085361.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Total Nacional</td>\n      <td>2022-10-01</td>\n      <td>47940295.0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>Total Nacional</td>\n      <td>2022-07-01</td>\n      <td>47781354.0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>Total Nacional</td>\n      <td>2022-04-01</td>\n      <td>47609145.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Total Nacional</td>\n      <td>2022-01-01</td>\n      <td>47486727.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nSi los tratas un poco, puedes usar mi librería favorita para hacer gráficos, matplotlib, en la que si tuviera que trabajar dejaría mi trabajo, me pagaran lo que me pagaran. \n\n::: {#prepara-plot .cell execution_count=3}\n``` {.python .cell-code}\ndf_solo_provincias = df_ine[df_ine['provincia'] != 'Total Nacional']\ndf_solo_provincias['residentes'] = df_solo_provincias['residentes'].fillna(method='ffill')\n\nprovincias_destacadas = ['28 Madrid', '08 Barcelona', '46 Valencia/València', '29 Málaga']\n\ndf_solo_provincias['destacada'] = df_solo_provincias['provincia'].apply(lambda x: x if x in provincias_destacadas else 'Otras')\n```\n:::\n\n\nDicen que construyendo más vivienda se solucionan los problemas de precios.\n\n::: {#cell-plot .cell execution_count=4}\n``` {.python .cell-code}\ncolors = {'28 Madrid': 'blue', '08 Barcelona': 'red', '46 Valencia/València': 'green', '29 Málaga': 'orange', 'Otras': 'lightgray'}\n\ndf_pivot = df_solo_provincias.pivot(index='periodo', columns='provincia', values='residentes')\n\nfig, ax = plt.subplots(figsize=(10, 6))\n\nfor provincia in df_pivot.columns:\n    color = colors[provincia] if provincia in provincias_destacadas else colors['Otras']\n    label = provincia if provincia in provincias_destacadas else '_nolegend_'\n    df_pivot[provincia].plot(ax=ax, color=color, label=label)\n\nplt.title('Evolución de la población por provincias en España')\nplt.ylabel('Residentes (millones)')\nplt.xlabel('')\nplt.legend()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/plot-output-1.png){#plot width=799 height=506}\n:::\n:::\n\n\nSuerte con pillar el ritmo a la demanda.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}