{
  "hash": "bf7e59e3430f7993777eb48fa08a0a5b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Relaciones espurias de datos de divorcios\"\ndescription: \"Ejemplos de relaciones espurias con Statistical Rethinking\"\ndescription-meta: \"Ejemplos de relaciones espurias con Statistical Rethinking\"\nauthor: \"Leonardo Hansa\"\ndate: \"2024-11-26\"\ncategories: [exploraciones]\nexecute: \n  echo: true\n  message: false\n  warning: false\nfreeze: true\n---\n\n\n\nEn el libro _Statistical Rethinking_ el autor estudia la relación entre el divorcio y dos variables: \n\n- La edad media en la que la pareja se casa. \n- La cantidad de gente que se casa.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rethinking)\nlibrary(ggplot2)\nggplot2::theme_set(ggplot2::theme_bw())\n\ndata(WaffleDivorce)\ndf_divorce <- WaffleDivorce\nhead(df_divorce)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Location Loc Population MedianAgeMarriage Marriage Marriage.SE Divorce\n1    Alabama  AL       4.78              25.3     20.2        1.27    12.7\n2     Alaska  AK       0.71              25.2     26.0        2.93    12.5\n3    Arizona  AZ       6.33              25.8     20.3        0.98    10.8\n4   Arkansas  AR       2.92              24.3     26.4        1.70    13.5\n5 California  CA      37.25              26.8     19.1        0.39     8.0\n6   Colorado  CO       5.03              25.7     23.5        1.24    11.6\n  Divorce.SE WaffleHouses South Slaves1860 Population1860 PropSlaves1860\n1       0.79          128     1     435080         964201           0.45\n2       2.05            0     0          0              0           0.00\n3       0.74           18     0          0              0           0.00\n4       1.22           41     1     111115         435450           0.26\n5       0.24            0     0          0         379994           0.00\n6       0.94           11     0          0          34277           0.00\n```\n\n\n:::\n:::\n\n\n\nPrimero estudia ambas variables por separado, como explicativas de la variable objetivo. Y luego usa las dos a la vez. \n\nLos modelos los plantea con las variables escaladas, con media 0 y desviación típica 1.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_divorce$A <- scale(df_divorce$MedianAgeMarriage)\ndf_divorce$D <- scale(df_divorce$Divorce)\ndf_divorce$M <- scale(df_divorce$Marriage)\n\nggplot(df_divorce) + \n  geom_histogram(aes(D), binwidth = 0.3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/pre-procesado-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_edad <- rethinking::quap(\n    alist(\n        D ~ dnorm(mu, sigma), \n        mu <- a + bA * A, \n        a ~ dnorm(0, 0.2),\n        bA ~ dnorm(0, 0.5),\n        sigma ~ dexp(1)\n    ), \n    data = df_divorce\n)\n\nprecis(fit_edad)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               mean         sd       5.5%      94.5%\na      2.249960e-07 0.09737883 -0.1556300  0.1556304\nbA    -5.684030e-01 0.10999989 -0.7442041 -0.3926019\nsigma  7.883263e-01 0.07801150  0.6636489  0.9130038\n```\n\n\n:::\n:::\n\n\n\nParece que edades tempranas de matrimonio se asocian a un mayor ratio de divorcios. \n\nPor otro lado:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_casados <- quap(\n    alist(\n        D ~ dnorm(mu, sigma), \n        mu <- a + bM * M,\n        bM ~ dnorm(0, 0.5), \n        a ~ dnorm(0, 0.2),\n        sigma ~ dexp(1)\n    ), \n    data = df_divorce\n)\n\nprecis(fit_casados)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              mean        sd       5.5%     94.5%\nbM    3.500456e-01 0.1259276  0.1487889 0.5513022\na     2.580548e-06 0.1082465 -0.1729962 0.1730014\nsigma 9.102662e-01 0.0898626  0.7666484 1.0538839\n```\n\n\n:::\n:::\n\n\n\nEl ratio de matrimonios también muestra una relación (positiva en este caso) con los divorcios. Parece razonable: cuanta más gente se case, más divorcios habrá. \n\nAhora bien, ¿es esto útil para predecir divorcios?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_ambas <- quap(\n    alist(\n        D ~ dnorm(mu, sigma),\n        mu  <- a + bA * A + bM * M,\n        bA ~ dnorm(0, 0.5),\n        bM ~ dnorm(0, 0.5), \n        a ~ dnorm(0, 0.2),\n        sigma ~ dexp(1)\n    ), \n    data = df_divorce\n)\n\nplot(coeftab(fit_edad, fit_casados, fit_ambas), par = c(\"bA\", \"bM\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/modelo-ambos-1.png){width=672}\n:::\n:::\n\n\n\n\nCuando están ambas variables, el ratio de matrimonios no tiene una relación significativa con el ratio de divorcios; no aporta información que la edad al casarse no esté aportando ya.\n\nQueda ahora pendiente ver si hay relación entre la edad al casarse y la cantidad de matrimonios.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_edad_casados <- quap(\n    alist(\n        M ~ dnorm(mu, sigma), \n        mu <- a + bA * A, \n        bA ~ dnorm(0, 0.5), \n        a ~ dnorm(0, 0.5),\n        sigma ~ dexp(1)\n    ), \n    data = df_divorce\n)\n\nprecis(fit_edad_casados)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               mean         sd       5.5%      94.5%\nbA    -6.947577e-01 0.09572744 -0.8477487 -0.5417668\na      3.730622e-05 0.09466898 -0.1512620  0.1513366\nsigma  6.817422e-01 0.06758133  0.5737341  0.7897502\n```\n\n\n:::\n:::\n\n\n\nLas prioris del modelo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprior <- extract.prior(fit_edad_casados)\nmu <- link(fit_edad_casados, post = prior, data = list(A=c(-2, 2)))\nhead(mu)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            [,1]        [,2]\n[1,]  0.40754123  0.55198721\n[2,] -0.97045287 -0.26903069\n[3,] -1.04597053  0.04440014\n[4,] -0.33992995  1.06002650\n[5,]  0.07748926  0.69109599\n[6,]  1.96460272 -0.69449517\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(NULL, xlim = c(-2, 2), ylim = c(-5, 5))\nfor (i in 1:50) {\n    lines(c(-2, 2), mu[i, ], col = \"gray\")\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/prioris1-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmu <- link(fit_edad)\nmu_mean <- apply(mu, 2, mean)\nmu_pi <- apply(mu, 2, PI)\n\n# D_sim <- sim(fit_edad, n = 1e3)\n# D_sim <- apply(D_sim, 2, PI)\n\nplot(mu_mean ~ df_divorce$D, col=rangi2, ylim = range(mu_pi), \n     xlab = \"Observed divorce\", ylab = \"Predicted divorce\")\nabline(a = 0, b = 1, lty = 2)\nfor (i in 1:nrow(df_divorce)) {\n    lines(rep(df_divorce$D[i], 2), mu_pi[, i], col = \"gray\")\n    # lines(rep(df_divorce$D[i], 2), D_sim[, i], col = \"blue\")\n}\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/prioris2-1.png){width=672}\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}