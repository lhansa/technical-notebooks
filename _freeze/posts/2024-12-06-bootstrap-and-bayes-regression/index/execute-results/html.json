{
  "hash": "eeaffa47498d0dab1f4ff63768db16ef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Regresión lineal bootstrap y bayesiana\"\ndescription: \"Comparativa de regresión lineal bootstrap y bayesiana\"\ndescription-meta: \"Comparativa de regresión lineal bootstrap y bayesiana\"\nauthor: \"Leonardo Hansa\"\ndate: \"2024-12-06\"\ncategories: [exploraciones]\nexecute: \n  echo: true\n  message: false\n  warning: false\nfreeze: true\n---\n\n\n\nDel libro _Statistical Rethinking_ tomo los datos de divorcios.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rethinking)\nlibrary(ggplot2)\nggplot2::theme_set(ggplot2::theme_bw())\n\ndata(WaffleDivorce)\ndf_divorce <- WaffleDivorce\nhead(df_divorce)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Location Loc Population MedianAgeMarriage Marriage Marriage.SE Divorce\n1    Alabama  AL       4.78              25.3     20.2        1.27    12.7\n2     Alaska  AK       0.71              25.2     26.0        2.93    12.5\n3    Arizona  AZ       6.33              25.8     20.3        0.98    10.8\n4   Arkansas  AR       2.92              24.3     26.4        1.70    13.5\n5 California  CA      37.25              26.8     19.1        0.39     8.0\n6   Colorado  CO       5.03              25.7     23.5        1.24    11.6\n  Divorce.SE WaffleHouses South Slaves1860 Population1860 PropSlaves1860\n1       0.79          128     1     435080         964201           0.45\n2       2.05            0     0          0              0           0.00\n3       0.74           18     0          0              0           0.00\n4       1.22           41     1     111115         435450           0.26\n5       0.24            0     0          0         379994           0.00\n6       0.94           11     0          0          34277           0.00\n```\n\n\n:::\n:::\n\n\n\nVoy a plantear una regresión del divorcio frente a la edad media de matrimonio. \n\nComo primer paso, procedo de la misma forma que el autor, esclando las variables.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_divorce$s_age <- scale(df_divorce$MedianAgeMarriage)\ndf_divorce$s_div <- scale(df_divorce$Divorce)\n```\n:::\n\n\n\n## Regresión lineal bootstrap\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbootstrap_size <- 1000\ncoef_df <- purrr::map_dfr(seq_len(bootstrap_size), function(i) {\n    filas = sample(\n        seq_len(nrow(df_divorce)), \n        size = nrow(df_divorce), \n        replace = TRUE\n    )\n\n    df_boot <- df_divorce[filas, ]\n    fit <- lm(s_div ~ s_age, data = df_boot)\n    coefs = coef(fit)\n    tibble::tibble(\n        intercept = coefs[1],\n        age = coefs[2]\n    )\n})\n\ncoef_df$id = seq_len(nrow(coef_df))\nhead(coef_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  intercept    age    id\n      <dbl>  <dbl> <int>\n1    0.0712 -0.645     1\n2    0.0440 -0.773     2\n3   -0.123  -0.413     3\n4   -0.215  -0.564     4\n5   -0.0332 -0.665     5\n6   -0.0946 -0.670     6\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() + \n    geom_point(\n        data = df_divorce, \n        aes(s_age, s_div), \n        size = 2\n    ) +\n    geom_abline(\n        data = coef_df, \n        aes(intercept = intercept, slope = age), \n        color = \"#800080\", alpha = 0.1\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bootstrap-plot-1.png){width=672}\n:::\n:::\n\n\n\n## Regresión lineal bayesiana\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- quap(\n    alist(\n        s_div ~ dnorm(mu, sigma), \n        mu <- a + b * s_age, \n        a ~ dnorm(0, 0.2),\n        b ~ dnorm(0, 0.5),\n        sigma ~ dexp(1)\n    ), \n    data = df_divorce\n)\n```\n:::\n\n\n\nAhora muestro los datos en un gráfico de dispersión y superpongo las rectas de regresión a posteriori.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npost <- extract.samples(fit)\npost_mean <- apply(post, 2, mean)\npost_hpd <- apply(post, 2, HPDI, prob = 0.89)\n\nggplot() + \n    geom_point(\n        data = df_divorce, \n        aes(s_age, s_div), \n        size = 2\n    ) +\n    geom_abline(\n        intercept = post_mean[1], \n        slope = post_mean[2], \n        color = \"#800080\"\n    ) +\n    geom_abline(\n        intercept = post_hpd[1, 1], \n        slope = post_hpd[2, 1], \n        linetype = \"dashed\", \n        color = \"#800080\"\n    ) +\n    geom_abline(\n        intercept = post_hpd[1, 2], \n        slope = post_hpd[2, 2], \n        linetype = \"dashed\", \n        color = \"#800080\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/bayes-plot-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}