<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Leonardo Hansa</title>
<link>https://lhansa.github.io/technical-notebooks/cuadernos.html</link>
<atom:link href="https://lhansa.github.io/technical-notebooks/cuadernos.xml" rel="self" type="application/rss+xml"/>
<description>Tips sobre análisis de datos</description>
<generator>quarto-1.6.43</generator>
<lastBuildDate>Thu, 17 Apr 2025 00:00:00 GMT</lastBuildDate>
<item>
  <title>Cómo corregir el optimismo de tu modelo estadístico</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2025-04-17-optimism-correction/</link>
  <description><![CDATA[ 




<section id="comentarios-iniciales" class="level2">
<h2 class="anchored" data-anchor-id="comentarios-iniciales">Comentarios iniciales</h2>
<p>Si entrenas un modelo en un conjunto de datos que no es muy grande, la métrica de ajuste que reportes no deberías calcularla sobre los datos de entrenamiento. Esto es porque el modelo ya conoce esos datos y se ha entrenado con ellos, intentando optimizar esa métrica de ajuste.</p>
<p>Lo típico es reservar un conjunto de validación, unos datos que el modelo no conoce, por lo que la métrica de ajuste no tendrá ese sesgo.</p>
<p>A ese sesgo lo llamamos <em>optimismo.</em></p>
<p>Lo malo, según Frank Harrell, es que, si tu conjunto de datos es pequeño, esa validación no será suficiente estable.</p>
<p><em>Bootstrap</em> es una solución.</p>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> fetch_openml</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.linear_model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LinearRegression</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> r2_score</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.utils <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> resample</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
</section>
<section id="bootstrap-para-corregir-el-optimismo" class="level2">
<h2 class="anchored" data-anchor-id="bootstrap-para-corregir-el-optimismo">Bootstrap para corregir el optimismo</h2>
<p>La idea es entrenar el modelo en varias muestras bootstrap y calcular la métrica de ajuste en cada par muestra bootstrap, muestra original, y luego la diferencia. Así, tendrás una lista de diferencias de longitud el número de muestras.</p>
<p>Luego calculas la media.</p>
<p>Finalmente, entrenas el modelo en la muestra original completa y le aplicas esa diferencia media.</p>
<p>La métrica de ajuste final será la métrica de ajuste en entrenamiento menos la diferencia, es decir, con el optimismo corregido.</p>
<section id="algunos-datos" class="level3">
<h3 class="anchored" data-anchor-id="algunos-datos">Algunos datos</h3>
<div id="load" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fetch_openml(name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boston"</span>, version<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, as_frame<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-2">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.data</span>
<span id="cb2-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.target</span>
<span id="cb2-4"></span>
<span id="cb2-5">X_np <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.to_numpy()</span>
<span id="cb2-6">y_np <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y.to_numpy()</span></code></pre></div>
</div>
</section>
<section id="entrenamiento-en-muestras-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="entrenamiento-en-muestras-bootstrap">Entrenamiento en muestras bootstrap</h3>
<div id="set-up-boots" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">n_bootstraps <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span></code></pre></div>
</div>
<p>Lo siguiente creo que quedaría más claro con un bucle <code>for</code>, pero en teoría no están recomendados. Así que creo una función y la llamo en una <em>list comprehension</em>.</p>
<div id="compute-optimism" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compute_optimism():</span>
<span id="cb4-2">    X_boot, y_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resample(X_np, y_np)</span>
<span id="cb4-3"></span>
<span id="cb4-4">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LinearRegression()</span>
<span id="cb4-5">    model.fit(X_boot, y_boot)</span>
<span id="cb4-6"></span>
<span id="cb4-7">    y_pred_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(X_boot)</span>
<span id="cb4-8">    r2_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r2_score(y_boot, y_pred_boot)</span>
<span id="cb4-9"></span>
<span id="cb4-10">    y_pred_orig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(X_np)</span>
<span id="cb4-11">    r2_orig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r2_score(y_np, y_pred_orig)</span>
<span id="cb4-12"></span>
<span id="cb4-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span>(r2_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> r2_orig)</span></code></pre></div>
</div>
<p>Y ahora calculo todo.</p>
<div id="list-optimism" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">optimism_estimates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [compute_optimism() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_bootstraps)]</span></code></pre></div>
</div>
</section>
<section id="cálculo-del-optimismo" class="level3">
<h3 class="anchored" data-anchor-id="cálculo-del-optimismo">Cálculo del optimismo</h3>
<p>El optimismo medio es lo que necesito para el próximo paso. Así que calculo la media de la lista que acabo de generar.</p>
<div id="cell-optimism" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">mean_optimism <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(optimism_estimates)</span>
<span id="cb6-2">mean_optimism</span></code></pre></div>
<div id="optimism" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.017757491298340335</code></pre>
</div>
</div>
<p>Por curiosidad, así se distribuye el optimismo.</p>
<div id="cell-histogram" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb8-2">plt.hist(optimism_estimates, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">plt.title(</span>
<span id="cb8-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribución del optimismo del modelo (bootstrap)"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb8-6">)</span>
<span id="cb8-7">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Optimismo estimado"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb8-8">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frecuencia"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb8-9"></span>
<span id="cb8-10">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb8-11">plt.xticks(fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb8-12">plt.yticks(fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb8-13">plt.tight_layout()</span>
<span id="cb8-14">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-04-17-optimism-correction/index_files/figure-html/histogram-output-1.png" id="histogram" width="759" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="entrenamiento-final" class="level3">
<h3 class="anchored" data-anchor-id="entrenamiento-final">Entrenamiento final</h3>
<p>Todos los entrenamientos anteriores estaban hechos sobre muestras <em>bootrstrap</em>, es decir, no estaban sobre el entrenamiento</p>
<div id="final-train" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">final_model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LinearRegression()</span>
<span id="cb9-2">final_model.fit(X_np, y_np)</span>
<span id="cb9-3">final_r2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r2_score(y_np, final_model.predict(X_np))</span></code></pre></div>
</div>
<div id="optimism-correct" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">corrected_r2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> final_r2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_optimism</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"R² original: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>final_r2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Optimismo medio: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mean_optimism<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"R² corregido: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>corrected_r2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R² original: 0.7406
Optimismo medio: 0.0178
R² corregido: 0.7229</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2025-04-17-optimism-correction/</guid>
  <pubDate>Thu, 17 Apr 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Cuánto te afecta la semilla al resultado final</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2025-04-12-semilla/</link>
  <description><![CDATA[ 




<section id="comentarios-iniciales" class="level2">
<h2 class="anchored" data-anchor-id="comentarios-iniciales">Comentarios iniciales</h2>
<p>En <a href="https://open.spotify.com/episode/0Bl4iZq1o5s2Kd5WESm2Cu?si=LgiczmLkTfOpc0vKREYI9w">Cuartil</a> mencionamos que cambiar la semilla puede cambiar la métrica de ajuste de tu modelo.</p>
<p>Voy a ajustar un RandomForest en algún conjunto de datos varias veces.</p>
<p>El objetivo es ver que, cada vez que lo ejecuto, la predicción cambia, por lo que hay cierta incertidumbre cada vez que ajustas un modelo de estos.</p>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.datasets <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_diabetes</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.ensemble <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RandomForestRegressor</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.model_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> train_test_split</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.metrics <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> r2_score</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span></code></pre></div>
</div>
</section>
<section id="preparación-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="preparación-de-datos">Preparación de datos</h2>
<p>Los datos no me importan especialmente. Cargo unos de <strong>sklearn</strong> que me ha sugerido ChatGPT. Los separo en train y test. Esta separación la dejo fija: voy a estudiar cómo afecta la aleatoriedad del modelo, no la de los datos.</p>
<div id="data" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_diabetes()</span>
<span id="cb2-2">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.data</span>
<span id="cb2-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.target</span>
<span id="cb2-4"></span>
<span id="cb2-5">X_train, X_test, y_train, y_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_test_split(</span>
<span id="cb2-6">    X, y, test_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span></span>
<span id="cb2-7">)</span></code></pre></div>
</div>
</section>
<section id="ajuste-de-los-modelos" class="level2">
<h2 class="anchored" data-anchor-id="ajuste-de-los-modelos">Ajuste de los modelos</h2>
<p>Ajusto 100 modelos. Voy a guardar algunas cosas de los ajustes para luego ver cómo varían de un caso a otro. Lo que quiero estudiar es si hay mucha dispersión entre unos resultados y otros.</p>
<div id="loop-model" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">num_trials <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span></span>
<span id="cb3-2">l_r2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb3-3">l_preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_trials):</span>
<span id="cb3-6">    random_state <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RandomForestRegressor(random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>random_state, n_jobs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-9"></span>
<span id="cb3-10">    model.fit(X_train, y_train)</span>
<span id="cb3-11"></span>
<span id="cb3-12">    y_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.predict(X_test)</span>
<span id="cb3-13">    l_r2.append(r2_score(y_test, y_pred))</span>
<span id="cb3-14"></span>
<span id="cb3-15">    pred_series <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series(y_pred, name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"pred_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-16"></span>
<span id="cb3-17">    l_preds.append(pred_series)</span></code></pre></div>
</div>
<p>Ahora creo el data frame de predicciones:</p>
<div id="concat" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">df_preds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat(l_preds, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
</section>
<section id="visualización" class="level2">
<h2 class="anchored" data-anchor-id="visualización">Visualización</h2>
<section id="métrica-de-ajuste" class="level3">
<h3 class="anchored" data-anchor-id="métrica-de-ajuste">Métrica de ajuste</h3>
<p>Aquí la distribución del R2.</p>
<div id="cell-hist-mse" class="cell" data-execution_count="5">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-04-12-semilla/index_files/figure-html/hist-mse-output-1.png" id="hist-mse" width="758" height="470" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="predicciones" class="level3">
<h3 class="anchored" data-anchor-id="predicciones">Predicciones</h3>
<p>Ahora muestro cómo varía cada predicción observación a observación. Muestro solo unas pocas porque no se ve nada si intento ver todas una a una.</p>
<p>Quizá no tenga sentido ver todas una a una, sino ver la desviación en general de todas las observación con respecto a su punto medio o su media o lo que sea. Pero paso de pensar.</p>
<div id="cell-preds-boxplots" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">df_long <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_preds.reset_index().melt(</span>
<span id="cb5-2">    id_vars<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>, var_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"modelo"</span>, value_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pred"</span></span>
<span id="cb5-3">)</span>
<span id="cb5-4">df_long <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_long.rename(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"index"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>})</span>
<span id="cb5-5"></span>
<span id="cb5-6">subset_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_long[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>].unique()[:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>]</span>
<span id="cb5-7">subset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_long[df_long[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>].isin(subset_ids)]</span>
<span id="cb5-8"></span>
<span id="cb5-9">medianas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subset.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pred"</span>].median().sort_values()</span>
<span id="cb5-10"></span>
<span id="cb5-11">subset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Categorical(subset[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>], categories<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>medianas.index, ordered<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-12"></span>
<span id="cb5-13">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>))</span>
<span id="cb5-14">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>subset, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>, x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pred"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span>, showfliers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb5-15">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ID de observación (subconjunto)"</span>)</span>
<span id="cb5-16">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicción"</span>)</span>
<span id="cb5-17">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Boxplot de predicciones por observación (unas pocas)"</span>)</span>
<span id="cb5-18">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb5-19">plt.tight_layout()</span>
<span id="cb5-20">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-04-12-semilla/index_files/figure-html/preds-boxplots-output-1.png" id="preds-boxplots" width="759" height="1430" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Hay alguna observación que sí presenta algo de variabilidad entre los modelos pero no me escandizaría por ello.</p>


</section>
</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2025-04-12-semilla/</guid>
  <pubDate>Sat, 12 Apr 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Tiempos de lectura de un fichero Excel</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2025-03-11-tiempos-lectura/</link>
  <description><![CDATA[ 




<p>Voy a intentar mejorar el tiempo de lectura de un fichero Excel.</p>
<section id="preparación-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="preparación-de-datos">Preparación de datos</h2>
<p>No tengo ninguno a mano, así que me lo invento. Genero un data frame con 1000 filas y 100 columnas y lo guardo en un fichero Excel.</p>
<p>Las columnas serán de distintos tipos:</p>
<ul>
<li>Las 10 primeras columnas serán de tipo fecha.</li>
<li>Las 10 columnas siguientes serán de tipo entero.</li>
<li>Las 10 columnas siguienets serán de tipo character.</li>
<li>Las demás columnas serán de tipo numérico.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-2"></span>
<span id="cb1-3">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb1-4">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-5"></span>
<span id="cb1-6">df_fechas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) {</span>
<span id="cb1-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-01-01"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-9">  })</span>
<span id="cb1-10">)</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df_fechas) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fecha_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-13"></span>
<span id="cb1-14">df_enteros <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) {</span>
<span id="cb1-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-17">  })</span>
<span id="cb1-18">)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df_enteros) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"entero_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-21"></span>
<span id="cb1-22">df_caracter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) {</span>
<span id="cb1-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(letters, n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb1-25">  })</span>
<span id="cb1-26">)</span>
<span id="cb1-27"></span>
<span id="cb1-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df_caracter) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"caracter_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-29"></span>
<span id="cb1-30">df_numericos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) {</span>
<span id="cb1-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n)</span>
<span id="cb1-33">  })</span>
<span id="cb1-34">)</span>
<span id="cb1-35"></span>
<span id="cb1-36"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(df_numericos) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numerico_"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>(m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>))</span>
<span id="cb1-37"></span>
<span id="cb1-38">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(df_fechas, df_enteros, df_caracter, df_numericos)</span>
<span id="cb1-39"></span>
<span id="cb1-40">writexl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write_xlsx</span>(df, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>)</span></code></pre></div>
</div>
</section>
<section id="prueba-1" class="level2">
<h2 class="anchored" data-anchor-id="prueba-1">Prueba 1</h2>
<p>Ahora leo el fichero Excel con la función <code>readxl::read_xlsx</code> y cuento tiempos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(microbenchmark)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readxl)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb2-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">excel =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_excel</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>),</span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlsx =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>),</span>
<span id="cb2-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb2-8">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
  expr      min       lq     mean   median       uq       max neval
 excel 818.9073 822.9448 859.8217 831.0066 932.1684  945.2294    10
  xlsx 815.5541 844.9630 941.4324 855.8534 938.4878 1501.5206    10</code></pre>
</div>
</div>
<p>Flipo por primera vez porque dejar que averigüe la extensión es más rápido que especificársela.</p>
</section>
<section id="prueba-2" class="level2">
<h2 class="anchored" data-anchor-id="prueba-2">Prueba 2</h2>
<p>Ahora intento acelerar esto. Una opción es usar la función <code>readxl::read_xlsx</code> con el argumento <code>guess_max</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb4-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlsx_1000 =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>),</span>
<span id="cb4-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlsx_10 =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">guess_max =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb4-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb4-5">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
      expr      min       lq     mean   median       uq       max neval
 xlsx_1000 810.2359 828.9868 891.8215 887.9481 942.6632 1013.5234    10
   xlsx_10 819.4436 830.5079 872.8056 848.1881 908.9467  987.3453    10</code></pre>
</div>
</div>
<p>Flipo por segunda vez porque dejar que adivine con 10 filas es más lento que dejarle que adivine con 1000.</p>
</section>
<section id="prueba-3" class="level2">
<h2 class="anchored" data-anchor-id="prueba-3">Prueba 3</h2>
<p>Ahora voy a especificar los tipos de columnas en el argumento col_types.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">col_types <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"numeric"</span>, m <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb6-6">)</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb6-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlsx_1000 =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>),</span>
<span id="cb6-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlsx_col_types =</span> readxl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_xlsx</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"~/Desktop/datos.xlsx"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col_types =</span> col_types),</span>
<span id="cb6-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">times =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb6-12">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
           expr      min       lq     mean   median       uq      max neval
      xlsx_1000 819.3382 826.5695 860.4852 834.8801 854.2142 989.9864    10
 xlsx_col_types 818.9725 829.1812 855.8303 846.0230 854.6138 923.9795    10</code></pre>
</div>
</div>
<p>Y me quedo flipando aún más porque lo de especificar <code>col_types</code> apenas ayuda (de hecho, si el número de filas es 1000 en lugar de 10000, empeora el tiempo; por lo menos, en una prueba que he hecho pero no he publicado).</p>
<hr>
<p>Mira, esto tiene trampa. El fichero Excel con el que estoy probando es pequeño. Si pruebas con un fichero grande, tipo 500.000 filas, o 1.000.000, es posible que los resultados sean más razonables.</p>
<p>Yo no lo hago porque mi ordenador peta. Pero lo puedes probar tú. Seguramente sí consigas en ese caso mejoras según dicta la intuición. Ahora bien, no creo que sean mejoras enormes.</p>
<p>Son mejoras que, si tienes que leer el fichero una vez, te van a dar igual. Te pueden venir bien si tienes muchos ficheros que leer, de forma que te ahorres 1 segundo por fichero y, en suma, aporte.</p>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2025-03-11-tiempos-lectura/</guid>
  <pubDate>Tue, 11 Mar 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Otro experimento con relaciones espurias</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2025-01-24-mas-relaciones-espurias/</link>
  <description><![CDATA[ 




<section id="datos-y-planteamiento" class="level2">
<h2 class="anchored" data-anchor-id="datos-y-planteamiento">Datos y planteamiento</h2>
<p>Tienes una variable <img src="https://latex.codecogs.com/png.latex?x_%7Breal%7D"> que genera dos variables: <img src="https://latex.codecogs.com/png.latex?y"> y <img src="https://latex.codecogs.com/png.latex?x_%7Bspur%7D">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rethinking)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"></span>
<span id="cb1-4">n_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-5">x_real <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n_data)</span>
<span id="cb1-6">x_spur <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n_data, x_real)</span>
<span id="cb1-7">y  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n_data, x_real)</span>
<span id="cb1-8"></span>
<span id="cb1-9">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(y, x_real, x_spur)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x_spur), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-01-24-mas-relaciones-espurias/index_files/figure-html/libs-and-data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Como la relación entre <img src="https://latex.codecogs.com/png.latex?x_%7Breal%7D"> y <img src="https://latex.codecogs.com/png.latex?x_%7Bspur%7D"> es alta, <img src="https://latex.codecogs.com/png.latex?x_%7Bspur%7D"> parece tener una relación con <img src="https://latex.codecogs.com/png.latex?y">.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x_spur, y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(x_spur, y), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-01-24-mas-relaciones-espurias/index_files/figure-html/plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Pero <img src="https://latex.codecogs.com/png.latex?y"> por definición depende únicamente de <img src="https://latex.codecogs.com/png.latex?x_%7Breal%7D">, por lo que la relación entre <img src="https://latex.codecogs.com/png.latex?x_%7Bspur%7D"> y <img src="https://latex.codecogs.com/png.latex?y"> es espuria.</p>
</section>
<section id="regresiones" class="level2">
<h2 class="anchored" data-anchor-id="regresiones">Regresiones</h2>
<p>La regresión que se ajusta según la definición sería:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">fit_real <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb3-3">    y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb3-4">    mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_real, </span>
<span id="cb3-5">    a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>), </span>
<span id="cb3-6">    b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb3-7">    sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-8">  ), </span>
<span id="cb3-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df</span>
<span id="cb3-10">)</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit_real)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean         sd        5.5%     94.5%
a     0.1200136 0.08733753 -0.01956863 0.2595958
b     1.0571869 0.09017250  0.91307384 1.2013000
sigma 0.9596754 0.06750045  0.85179669 1.0675542</code></pre>
</div>
</div>
<p>Si intentas ajustar una regresión que incluya a la variable espuria, el modelo te la rechazará.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb5-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb5-3">        y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb5-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b_spur <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_spur <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b_real <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_real, </span>
<span id="cb5-5">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb5-6">        b_spur <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb5-7">        b_real <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb5-8">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-9">    ), </span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df</span>
<span id="cb5-11">)</span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              mean         sd        5.5%     94.5%
a       0.11982176 0.08719034 -0.01952525 0.2591688
b_spur -0.03306708 0.09448089 -0.18406579 0.1179316
b_real  1.09219751 0.13449093  0.87725503 1.3071400
sigma   0.95766044 0.06749719  0.84978689 1.0655340</code></pre>
</div>
</div>
<p>Si no quieres hacerlo bayesiano:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit_lm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x_spur <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x_real, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(fit_lm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x_spur + x_real, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.26639 -0.58538 -0.03526  0.66746  2.29240 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.14138    0.09862   1.434    0.155    
x_spur      -0.07976    0.09989  -0.798    0.427    
x_real       1.17575    0.14336   8.201    1e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9749 on 97 degrees of freedom
Multiple R-squared:  0.5856,    Adjusted R-squared:  0.577 
F-statistic: 68.53 on 2 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Otra opción sería que sí usaras la variable espuria pero no la real:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">fit_spur <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb9-3">    y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb9-4">    mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_spur, </span>
<span id="cb9-5">    a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb9-6">    b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb9-7">    sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-8">  ), </span>
<span id="cb9-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df</span>
<span id="cb9-10">)</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit_spur)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean         sd        5.5%     94.5%
a     0.1670335 0.10619925 -0.00269343 0.3367604
b     0.5325380 0.08162221  0.40208999 0.6629861
sigma 1.2435069 0.08730279  1.10398016 1.3830336</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2025-01-24-mas-relaciones-espurias/</guid>
  <pubDate>Fri, 24 Jan 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Experimento con multicolinealidad</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2025-01-16-autocolinealidad/</link>
  <description><![CDATA[ 




<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sm</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.regression.linear_model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> OLS</span></code></pre></div>
</div>
<section id="multicolinealidad-en-la-regresión-lineal-con-muestras-grandes" class="level2">
<h2 class="anchored" data-anchor-id="multicolinealidad-en-la-regresión-lineal-con-muestras-grandes">Multicolinealidad en la regresión lineal con muestras grandes</h2>
<p>Tienes una variable <img src="https://latex.codecogs.com/png.latex?y"> que depende de dos variables <img src="https://latex.codecogs.com/png.latex?x_1"> y <img src="https://latex.codecogs.com/png.latex?x_2">. Pero <img src="https://latex.codecogs.com/png.latex?x_2"> es una combinación lineal de <img src="https://latex.codecogs.com/png.latex?x_1">.</p>
<div id="datos" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb2-4">x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span>
<span id="cb2-5">x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, n)</span>
<span id="cb2-6">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span></code></pre></div>
</div>
<p>Por si hay alguna duda:</p>
<div id="cell-correlacion" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">np.corrcoef(x1, x2)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div id="correlacion" class="cell-output cell-output-display" data-execution_count="3">
<pre><code>0.7074774568946038</code></pre>
</div>
</div>
<p>¿Qué pasa si usas <img src="https://latex.codecogs.com/png.latex?x_1"> y <img src="https://latex.codecogs.com/png.latex?x_2"> en una regresión lineal?</p>
<div id="regresion" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.column_stack((x1, x2))</span>
<span id="cb5-2">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.add_constant(X)</span>
<span id="cb5-3"></span>
<span id="cb5-4">modelo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OLS(y, X).fit()</span>
<span id="cb5-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(modelo.summary())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.967
Model:                            OLS   Adj. R-squared:                  0.967
Method:                 Least Squares   F-statistic:                 1.465e+05
Date:                Wed, 12 Mar 2025   Prob (F-statistic):               0.00
Time:                        15:34:28   Log-Likelihood:                -37142.
No. Observations:               10000   AIC:                         7.429e+04
Df Residuals:                    9997   BIC:                         7.431e+04
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          2.2011      0.508      4.332      0.000       1.205       3.197
x1             3.0220      0.014    214.712      0.000       2.994       3.050
x2             3.9480      0.020    199.329      0.000       3.909       3.987
==============================================================================
Omnibus:                        0.071   Durbin-Watson:                   1.994
Prob(Omnibus):                  0.965   Jarque-Bera (JB):                0.085
Skew:                           0.005   Prob(JB):                        0.958
Kurtosis:                       2.989   Cond. No.                         293.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p>Pues aparentemente nada. Los coeficientes son los esperados y las <img src="https://latex.codecogs.com/png.latex?t">-stats son altas.</p>
</section>
<section id="multicolinealidad-en-la-regresión-lineal-con-muestras-pequeñas" class="level2">
<h2 class="anchored" data-anchor-id="multicolinealidad-en-la-regresión-lineal-con-muestras-pequeñas">Multicolinealidad en la regresión lineal con muestras pequeñas</h2>
<p>Antes tenías una muestra de tamaño 10000. Vamos a cambiar eso.</p>
<div id="datos-pequenos" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb7-2">x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span>
<span id="cb7-3">x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, n)</span>
<span id="cb7-4">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span></code></pre></div>
</div>
<p>Con estos datos, aparentemente los mismos pero con menor muestra, ajusto la regresión.</p>
<div id="regresion-pequena" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.column_stack((x1, x2))</span>
<span id="cb8-2">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.add_constant(X)</span>
<span id="cb8-3"></span>
<span id="cb8-4">modelo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OLS(y, X).fit()</span>
<span id="cb8-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(modelo.summary())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.974
Model:                            OLS   Adj. R-squared:                  0.973
Method:                 Least Squares   F-statistic:                     1810.
Date:                Wed, 12 Mar 2025   Prob (F-statistic):           1.60e-77
Time:                        15:34:28   Log-Likelihood:                -367.78
No. Observations:                 100   AIC:                             741.6
Df Residuals:                      97   BIC:                             749.4
Df Model:                           2                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -1.7233      4.880     -0.353      0.725     -11.410       7.963
x1             3.0745      0.140     21.956      0.000       2.797       3.352
x2             3.9304      0.190     20.682      0.000       3.553       4.308
==============================================================================
Omnibus:                        0.041   Durbin-Watson:                   2.129
Prob(Omnibus):                  0.980   Jarque-Bera (JB):                0.191
Skew:                           0.014   Prob(JB):                        0.909
Kurtosis:                       2.788   Cond. No.                         295.
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p>Los coeficientes de <img src="https://latex.codecogs.com/png.latex?x_1"> y <img src="https://latex.codecogs.com/png.latex?x_2"> no son horribles, pero el intercept ya no tiene sentido.</p>
</section>
<section id="incertidumbre" class="level2">
<h2 class="anchored" data-anchor-id="incertidumbre">Incertidumbre</h2>
<p>Los resultados de la regresión pueden mejorar, no solo por tener más datos, sino simplemente por una muestra que encaje mejor.</p>
<p>Así que vamos a generar muchas muestras, de distintos tamaños, y vemos en cada una cómo cambian los coeficientes.</p>
<div id="simulacion" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">n_sizes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>])</span>
<span id="cb10-2"></span>
<span id="cb10-3">runs_per_size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb10-4"></span>
<span id="cb10-5">coeficientes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(n_sizes), runs_per_size, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, n <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(n_sizes):</span>
<span id="cb10-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> j <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(runs_per_size):</span>
<span id="cb10-9">        x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span>
<span id="cb10-10">        x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, n)</span>
<span id="cb10-11">        y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, n)</span>
<span id="cb10-12">        </span>
<span id="cb10-13">        X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.column_stack((x1, x2))</span>
<span id="cb10-14">        X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.add_constant(X)</span>
<span id="cb10-15"></span>
<span id="cb10-16">        modelo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> OLS(y, X).fit()</span>
<span id="cb10-17">        coeficientes[i, j] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> modelo.params</span></code></pre></div>
</div>
<p>Visualizo los coeficientes como puntos, incluido el intercept. En el eje <img src="https://latex.codecogs.com/png.latex?x"> tienes el tamaño de la muestra y en el eje <img src="https://latex.codecogs.com/png.latex?y"> el valor del coeficiente. La línea horizontal es el valor real del coeficiente.</p>
<p>Fíjate cómo, cuanto menor es el tamaño muestral, menor es la precisión de la estimación. No creas que por que alguna vez salga bien con una muestra, tu estimación va a ser buena. La incertidumbre es alta, te guste o no.</p>
<div id="cell-grafico" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb11-2"></span>
<span id="cb11-3">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(runs_per_size):</span>
<span id="cb11-6">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].scatter(n_sizes, coeficientes[:, i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb11-7">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].scatter(n_sizes, coeficientes[:, i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb11-8">    ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].scatter(n_sizes, coeficientes[:, i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb11-9"></span>
<span id="cb11-10">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span>
<span id="cb11-11">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span>
<span id="cb11-12">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span>
<span id="cb11-13"></span>
<span id="cb11-14"></span>
<span id="cb11-15">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Intercept'</span>)</span>
<span id="cb11-16">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Coeficiente de x1'</span>)</span>
<span id="cb11-17">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Coeficiente de x2'</span>)</span>
<span id="cb11-18"></span>
<span id="cb11-19">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2025-01-16-autocolinealidad/index_files/figure-html/grafico-output-1.png" id="grafico" width="1399" height="357" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2025-01-16-autocolinealidad/</guid>
  <pubDate>Thu, 16 Jan 2025 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Contraste de medias, estilo bayesiano</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-12-11-contraste-bayesiano/</link>
  <description><![CDATA[ 




<p>Los contrastes de hipótesis me parecen de lo más contraintuitivo en el mundo frecuentista.</p>
<p>El resultado que da la estadística bayesiana es mucho más natural y fácil de interpretar (frase de Copilot)</p>
<p>Simulo unos datos y luego voy a intentar contrastar si su la media de los datos es la que creo que es.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rethinking)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3"></span>
<span id="cb1-4">n_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb1-5">pop_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span></span>
<span id="cb1-6">pop_sd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-7">real_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n_data, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> pop_mean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> pop_sd)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(real_data), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-12-11-contraste-bayesiano/index_files/figure-html/libs-and-data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Pongo de prioris los datos que ya sé válidos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">fit1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb2-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb2-3">        y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb2-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a, </span>
<span id="cb2-5">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(pop_mean, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), </span>
<span id="cb2-6">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(pop_sd, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-7">    ),</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> real_data)</span>
<span id="cb2-9">)</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit1)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean         sd      5.5%    94.5%
a     24.987641 0.05066636 24.906666 25.06862
sigma  5.068262 0.03581411  5.011025  5.12550</code></pre>
</div>
</div>
<p>Incluso con unos prioris malísimos, el resultado es el correcto (y más fácil de interpretar).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">fit2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb4-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb4-3">        y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb4-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a, </span>
<span id="cb4-5">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), </span>
<span id="cb4-6">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-7">    ), </span>
<span id="cb4-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> real_data)</span>
<span id="cb4-9">)</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit2)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           mean         sd      5.5%     94.5%
a     24.985067 0.05066808 24.904089 25.066044
sigma  5.067067 0.03581597  5.009826  5.124308</code></pre>
</div>
</div>



 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-12-11-contraste-bayesiano/</guid>
  <pubDate>Wed, 11 Dec 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Regresión lineal bootstrap y bayesiana</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-12-06-bootstrap-and-bayes-regression/</link>
  <description><![CDATA[ 




<p>Del libro <em>Statistical Rethinking</em> tomo los datos de divorcios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rethinking)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3">ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>())</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WaffleDivorce)</span>
<span id="cb1-6">df_divorce <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WaffleDivorce</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df_divorce)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Location Loc Population MedianAgeMarriage Marriage Marriage.SE Divorce
1    Alabama  AL       4.78              25.3     20.2        1.27    12.7
2     Alaska  AK       0.71              25.2     26.0        2.93    12.5
3    Arizona  AZ       6.33              25.8     20.3        0.98    10.8
4   Arkansas  AR       2.92              24.3     26.4        1.70    13.5
5 California  CA      37.25              26.8     19.1        0.39     8.0
6   Colorado  CO       5.03              25.7     23.5        1.24    11.6
  Divorce.SE WaffleHouses South Slaves1860 Population1860 PropSlaves1860
1       0.79          128     1     435080         964201           0.45
2       2.05            0     0          0              0           0.00
3       0.74           18     0          0              0           0.00
4       1.22           41     1     111115         435450           0.26
5       0.24            0     0          0         379994           0.00
6       0.94           11     0          0          34277           0.00</code></pre>
</div>
</div>
<p>Voy a plantear una regresión del divorcio frente a la edad media de matrimonio.</p>
<p>Como primer paso, procedo de la misma forma que el autor, esclando las variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_age <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MedianAgeMarriage)</span>
<span id="cb3-2">df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s_div <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Divorce)</span></code></pre></div>
</div>
<section id="regresión-lineal-bootstrap" class="level2">
<h2 class="anchored" data-anchor-id="regresión-lineal-bootstrap">Regresión lineal bootstrap</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">bootstrap_size <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb4-2">coef_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_len</span>(bootstrap_size), <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) {</span>
<span id="cb4-3">    filas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb4-4">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_len</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df_divorce)), </span>
<span id="cb4-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df_divorce), </span>
<span id="cb4-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb4-7">    )</span>
<span id="cb4-8"></span>
<span id="cb4-9">    df_boot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_divorce[filas, ]</span>
<span id="cb4-10">    fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(s_div <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> s_age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_boot)</span>
<span id="cb4-11">    coefs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coef</span>(fit)</span>
<span id="cb4-12">    tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb4-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> coefs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb4-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> coefs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb4-15">    )</span>
<span id="cb4-16">})</span>
<span id="cb4-17"></span>
<span id="cb4-18">coef_df<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq_len</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(coef_df))</span>
<span id="cb4-19"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(coef_df)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  intercept    age    id
      &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1    0.0712 -0.645     1
2    0.0440 -0.773     2
3   -0.123  -0.413     3
4   -0.215  -0.564     4
5   -0.0332 -0.665     5
6   -0.0946 -0.670     6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb6-3">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce, </span>
<span id="cb6-4">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(s_age, s_div), </span>
<span id="cb6-5">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-6">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(</span>
<span id="cb6-8">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> coef_df, </span>
<span id="cb6-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> intercept, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> age), </span>
<span id="cb6-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb6-11">    )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-12-06-bootstrap-and-bayes-regression/index_files/figure-html/bootstrap-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="regresión-lineal-bayesiana" class="level2">
<h2 class="anchored" data-anchor-id="regresión-lineal-bayesiana">Regresión lineal bayesiana</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb7-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb7-3">        s_div <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb7-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> s_age, </span>
<span id="cb7-5">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb7-6">        b <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb7-7">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-8">    ), </span>
<span id="cb7-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce</span>
<span id="cb7-10">)</span></code></pre></div>
</div>
<p>Ahora muestro los datos en un gráfico de dispersión y superpongo las rectas de regresión a posteriori.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">post <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract.samples</span>(fit)</span>
<span id="cb8-2">post_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(post, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean)</span>
<span id="cb8-3">post_hpd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(post, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, HPDI, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.89</span>)</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb8-7">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce, </span>
<span id="cb8-8">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(s_age, s_div), </span>
<span id="cb8-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb8-10">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(</span>
<span id="cb8-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> post_mean[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb8-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> post_mean[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], </span>
<span id="cb8-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span></span>
<span id="cb8-15">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(</span>
<span id="cb8-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> post_hpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb8-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> post_hpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb8-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, </span>
<span id="cb8-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span></span>
<span id="cb8-21">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(</span>
<span id="cb8-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> post_hpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], </span>
<span id="cb8-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> post_hpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], </span>
<span id="cb8-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, </span>
<span id="cb8-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span></span>
<span id="cb8-27">    )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-12-06-bootstrap-and-bayes-regression/index_files/figure-html/bayes-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-12-06-bootstrap-and-bayes-regression/</guid>
  <pubDate>Fri, 06 Dec 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Relaciones espurias de datos de divorcios</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/</link>
  <description><![CDATA[ 




<p>En el libro <em>Statistical Rethinking</em> el autor estudia la relación entre el divorcio y dos variables:</p>
<ul>
<li>La edad media en la que la pareja se casa.</li>
<li>La cantidad de gente que se casa.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rethinking)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-3">ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_bw</span>())</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data</span>(WaffleDivorce)</span>
<span id="cb1-6">df_divorce <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> WaffleDivorce</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(df_divorce)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Location Loc Population MedianAgeMarriage Marriage Marriage.SE Divorce
1    Alabama  AL       4.78              25.3     20.2        1.27    12.7
2     Alaska  AK       0.71              25.2     26.0        2.93    12.5
3    Arizona  AZ       6.33              25.8     20.3        0.98    10.8
4   Arkansas  AR       2.92              24.3     26.4        1.70    13.5
5 California  CA      37.25              26.8     19.1        0.39     8.0
6   Colorado  CO       5.03              25.7     23.5        1.24    11.6
  Divorce.SE WaffleHouses South Slaves1860 Population1860 PropSlaves1860
1       0.79          128     1     435080         964201           0.45
2       2.05            0     0          0              0           0.00
3       0.74           18     0          0              0           0.00
4       1.22           41     1     111115         435450           0.26
5       0.24            0     0          0         379994           0.00
6       0.94           11     0          0          34277           0.00</code></pre>
</div>
</div>
<p>Primero estudia ambas variables por separado, como explicativas de la variable objetivo. Y luego usa las dos a la vez.</p>
<p>Los modelos los plantea con las variables escaladas, con media 0 y desviación típica 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MedianAgeMarriage)</span>
<span id="cb3-2">df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>D <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Divorce)</span>
<span id="cb3-3">df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Marriage)</span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_divorce) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(D), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binwidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/index_files/figure-html/pre-procesado-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">fit_edad <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rethinking<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb4-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb4-3">        D <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb4-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> A, </span>
<span id="cb4-5">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb4-6">        bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb4-7">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-8">    ), </span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce</span>
<span id="cb4-10">)</span>
<span id="cb4-11"></span>
<span id="cb4-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit_edad)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               mean         sd       5.5%      94.5%
a      2.249960e-07 0.09737883 -0.1556300  0.1556304
bA    -5.684030e-01 0.10999989 -0.7442041 -0.3926019
sigma  7.883263e-01 0.07801150  0.6636489  0.9130038</code></pre>
</div>
</div>
<p>Parece que edades tempranas de matrimonio se asocian a un mayor ratio de divorcios.</p>
<p>Por otro lado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">fit_casados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb6-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb6-3">        D <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb6-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> M,</span>
<span id="cb6-5">        bM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), </span>
<span id="cb6-6">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb6-7">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-8">    ), </span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce</span>
<span id="cb6-10">)</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit_casados)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              mean        sd       5.5%     94.5%
bM    3.500456e-01 0.1259276  0.1487889 0.5513022
a     2.580548e-06 0.1082465 -0.1729962 0.1730014
sigma 9.102662e-01 0.0898626  0.7666484 1.0538839</code></pre>
</div>
</div>
<p>El ratio de matrimonios también muestra una relación (positiva en este caso) con los divorcios. Parece razonable: cuanta más gente se case, más divorcios habrá.</p>
<p>Ahora bien, ¿es esto útil para predecir divorcios?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">fit_ambas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb8-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb8-3">        D <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma),</span>
<span id="cb8-4">        mu  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> M,</span>
<span id="cb8-5">        bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb8-6">        bM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), </span>
<span id="cb8-7">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb8-8">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-9">    ), </span>
<span id="cb8-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce</span>
<span id="cb8-11">)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coeftab</span>(fit_edad, fit_casados, fit_ambas), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bM"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/index_files/figure-html/modelo-ambos-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Cuando están ambas variables, el ratio de matrimonios no tiene una relación significativa con el ratio de divorcios; no aporta información que la edad al casarse no esté aportando ya.</p>
<p>Queda ahora pendiente ver si hay relación entre la edad al casarse y la cantidad de matrimonios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">fit_edad_casados <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quap</span>(</span>
<span id="cb9-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alist</span>(</span>
<span id="cb9-3">        M <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(mu, sigma), </span>
<span id="cb9-4">        mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> A, </span>
<span id="cb9-5">        bA <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>), </span>
<span id="cb9-6">        a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb9-7">        sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dexp</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-8">    ), </span>
<span id="cb9-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> df_divorce</span>
<span id="cb9-10">)</span>
<span id="cb9-11"></span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">precis</span>(fit_edad_casados)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               mean         sd       5.5%      94.5%
bA    -6.947577e-01 0.09572744 -0.8477487 -0.5417668
a      3.730622e-05 0.09466898 -0.1512620  0.1513366
sigma  6.817422e-01 0.06758133  0.5737341  0.7897502</code></pre>
</div>
</div>
<p>Las prioris del modelo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract.prior</span>(fit_edad_casados)</span>
<span id="cb11-2">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">link</span>(fit_edad_casados, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">post =</span> prior, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(mu)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]        [,2]
[1,]  0.40754123  0.55198721
[2,] -0.97045287 -0.26903069
[3,] -1.04597053  0.04440014
[4,] -0.33992995  1.06002650
[5,]  0.07748926  0.69109599
[6,]  1.96460272 -0.69449517</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb13-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>) {</span>
<span id="cb13-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), mu[i, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>)</span>
<span id="cb13-4">}</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/index_files/figure-html/prioris1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">link</span>(fit_edad)</span>
<span id="cb14-2">mu_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mu, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, mean)</span>
<span id="cb14-3">mu_pi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(mu, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, PI)</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D_sim &lt;- sim(fit_edad, n = 1e3)</span></span>
<span id="cb14-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D_sim &lt;- apply(D_sim, 2, PI)</span></span>
<span id="cb14-7"></span>
<span id="cb14-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(mu_mean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>D, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>rangi2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(mu_pi), </span>
<span id="cb14-9">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Observed divorce"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted divorce"</span>)</span>
<span id="cb14-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(df_divorce)) {</span>
<span id="cb14-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(df_divorce<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>D[i], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), mu_pi[, i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>)</span>
<span id="cb14-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># lines(rep(df_divorce$D[i], 2), D_sim[, i], col = "blue")</span></span>
<span id="cb14-14">}</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/index_files/figure-html/prioris2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>



 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-11-26-espurias/</guid>
  <pubDate>Tue, 26 Nov 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Quita caracteres raros en tus variables (2)</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-31-pyjanitor/</link>
  <description><![CDATA[ 




<p>El otro día <a href="https://lhansa.github.io/posts/2024-10-18-quita-caracteres-raros-en-tus-variables/">te compartí ideas</a> de cómo adaptar valores de texto que no te sirven como nombres de columnas. En R.</p>
<p><a href="https://muestrear-no-es-pecado.netlify.app/">José Luis Cañadas</a> me habló de la librería <strong>pyjanitor</strong> como alternativa en Python. Me sonaba lejanamente pero nunca la había usado.</p>
<p>Aporta muchas más cosas aparte de cambiar textos para que cumplan con ciertas reglas de estilo. En cierto modo te da toda una nueva sintaxis para hacer las operaciones que haces con pandas de una forma más parecida al <strong>tidyverse</strong>.</p>
<p>Ahora mismo no es lo busco. Lo que busco es replicar el ejercicio del otro día.</p>
<p>Así que vamos a ello.</p>
<section id="pyjanitor" class="level2">
<h2 class="anchored" data-anchor-id="pyjanitor"><code>pyjanitor</code></h2>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> janitor</span></code></pre></div>
</div>
<p>Teníamos un listado de nombres que en un proyecto real vendrían como valores de la columna de un data frame. Y están repetidos.</p>
<div id="01091ce0" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">nombres <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campaña veintitrés"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C'est très petite"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alışveriş Arabası Önü Giydirme"</span>]</span>
<span id="cb2-2">nombres <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nombres <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb2-3">nombres</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>['Campaña veintitrés',
 "C'est très petite",
 'Alışveriş Arabası Önü Giydirme',
 'Campaña veintitrés',
 "C'est très petite",
 'Alışveriş Arabası Önü Giydirme']</code></pre>
</div>
</div>
<p>Queremos reescribirlos para que sigan un estilo válido como nombres de columnas. Este estilo es opinable, pero para ir al grano asumiré que lo que quiero es esto:</p>
<ul>
<li><em>snake case</em>, es decir, todo en minúscula con palabras separadas por barras bajas.</li>
<li>Sin tildes, ni eñes ni otros caracteres raros (donde raro es no anglosajón).</li>
<li>… Y más cosas que ahora me dan igual.</li>
</ul>
<p>La librería janitor está pensada para trabajar directamente con un data frame. Pero no es lo que busco ahora. Es más: la funcionalidad de limpiar valores de una columna (no nombres) ni siquiera está a mano.</p>
</section>
<section id="la-función-escondida" class="level2">
<h2 class="anchored" data-anchor-id="la-función-escondida">La función escondida</h2>
<p>He <a href="https://github.com/pyjanitor-devs/pyjanitor/blob/dev/janitor/functions/clean_names.py">curioseado el código fuente</a> y he encontrado la función que limpia los nombres de las columnas, es decir, el código que aplica las reglas de limpieza.</p>
<p>Este código está un poco escondido, pero lo puedes llamar directamenmte sobre una serie de pandas (es decir, lo que podría llegar a ser una columna de un data frame).</p>
<p>La función es <code>_clean_names</code> y su primer argumento es la serie que quieres editar. Ninguno de los argumentos de configuración tiene valor por defecto, así que hay que especificarlos todos.</p>
<div id="94aa650a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> janitor.functions.clean_names <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> _clean_names</span>
<span id="cb4-2"></span>
<span id="cb4-3">nombres <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series(nombres)</span>
<span id="cb4-4">nuevos_nombres <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> _clean_names(</span>
<span id="cb4-5">    nombres,</span>
<span id="cb4-6">    strip_underscores<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb4-7">    case_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'snake'</span>, </span>
<span id="cb4-8">    remove_special<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb4-9">    strip_accents<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb4-10">    enforce_string<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, </span>
<span id="cb4-11">    truncate_limit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb4-12"></span>
<span id="cb4-13">nuevos_nombres</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0            campaa_veintitrs
1             cest_trs_petite
2    alveri_arabas_n_giydirme
3            campaa_veintitrs
4             cest_trs_petite
5    alveri_arabas_n_giydirme
dtype: object</code></pre>
</div>
</div>
<p>No queda igual que en el caso de R (por ejemplo, las eñes las quita pero no las convierte a enes) pero para lo que quiero hacer aquí me vale.</p>
<p>Gracias, José Luis, como siempre, que incluso con Python me ayudas.</p>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-31-pyjanitor/</guid>
  <pubDate>Thu, 31 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Evolución de la población por provincias en España</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-27-poblacion-evolutivo/</link>
  <description><![CDATA[ 




<p>El INE tiene datos de evolución <del>trimestral</del> semestral de la población por provincias en España.</p>
<p>En un formato horrible, por supuesto.</p>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> locale</span></code></pre></div>
</div>
<div id="cell-read-data" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">locale.setlocale(locale.LC_TIME, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'es_ES.UTF-8'</span>)</span>
<span id="cb2-2"></span>
<span id="cb2-3">df_ine <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(</span>
<span id="cb2-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ine-poblacion-provincias.csv'</span>, </span>
<span id="cb2-5">    sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">';'</span>, </span>
<span id="cb2-6">    header<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, </span>
<span id="cb2-7">    names<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'edad'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provincia'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sexo'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodo'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>]</span>
<span id="cb2-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># usecols=['provincia', 'periodo', 'residentes']</span></span>
<span id="cb2-9">)</span>
<span id="cb2-10"></span>
<span id="cb2-11">condicion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'edad'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Todas las edades'</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'sexo'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total'</span>)</span>
<span id="cb2-12">df_ine <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ine.loc[condicion, [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provincia'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodo'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>]]</span>
<span id="cb2-13"></span>
<span id="cb2-14">df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_numeric(df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'.'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>))</span>
<span id="cb2-15">df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodo'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodo'</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> de %B de %Y'</span>)</span>
<span id="cb2-16"></span>
<span id="cb2-17">df_ine.head()</span></code></pre></div>
<div id="read-data" class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">provincia</th>
<th data-quarto-table-cell-role="th">periodo</th>
<th data-quarto-table-cell-role="th">residentes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Total Nacional</td>
<td>2023-01-01</td>
<td>48085361.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Total Nacional</td>
<td>2022-10-01</td>
<td>47940295.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Total Nacional</td>
<td>2022-07-01</td>
<td>47781354.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Total Nacional</td>
<td>2022-04-01</td>
<td>47609145.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Total Nacional</td>
<td>2022-01-01</td>
<td>47486727.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Si los tratas un poco, puedes usar mi librería favorita para hacer gráficos, matplotlib, en la que si tuviera que trabajar dejaría mi trabajo, me pagaran lo que me pagaran.</p>
<div id="prepara-plot" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">df_solo_provincias <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ine[df_ine[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provincia'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Total Nacional'</span>]</span>
<span id="cb3-2">df_solo_provincias[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_solo_provincias[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>].fillna(method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ffill'</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">provincias_destacadas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'28 Madrid'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'08 Barcelona'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'46 Valencia/València'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'29 Málaga'</span>]</span>
<span id="cb3-5"></span>
<span id="cb3-6">df_solo_provincias[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'destacada'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_solo_provincias[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provincia'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> provincias_destacadas <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Otras'</span>)</span></code></pre></div>
</div>
<p>Dicen que construyendo más vivienda se solucionan los problemas de precios.</p>
<div id="cell-plot" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">colors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'28 Madrid'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'08 Barcelona'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'46 Valencia/València'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'29 Málaga'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Otras'</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lightgray'</span>}</span>
<span id="cb4-2"></span>
<span id="cb4-3">df_pivot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_solo_provincias.pivot(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'periodo'</span>, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'provincia'</span>, values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'residentes'</span>)</span>
<span id="cb4-4"></span>
<span id="cb4-5">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> provincia <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df_pivot.columns:</span>
<span id="cb4-8">    color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> colors[provincia] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> provincia <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> provincias_destacadas <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> colors[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Otras'</span>]</span>
<span id="cb4-9">    label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> provincia <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> provincia <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> provincias_destacadas <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_nolegend_'</span></span>
<span id="cb4-10">    df_pivot[provincia].plot(ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label)</span>
<span id="cb4-11"></span>
<span id="cb4-12">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Evolución de la población por provincias en España'</span>)</span>
<span id="cb4-13">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Residentes (millones)'</span>)</span>
<span id="cb4-14">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>)</span>
<span id="cb4-15">plt.legend()</span>
<span id="cb4-16">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-27-poblacion-evolutivo/index_files/figure-html/plot-output-1.png" id="plot" width="799" height="506" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Suerte con pillar el ritmo a la demanda.</p>



 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-27-poblacion-evolutivo/</guid>
  <pubDate>Sun, 27 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Juego probabilístico con números aleatorios</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-23-random-numbers/</link>
  <description><![CDATA[ 




<p>Para trabajar con números aleatorios en Python parece que la referencia es usar <strong>numpy</strong>.</p>
<div id="librerias" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<section id="numpy-básico" class="level2">
<h2 class="anchored" data-anchor-id="numpy-básico">numpy básico</h2>
<p>Vamos a simular muchos lanzamientos de 4 monedas y vamos a ver en qué proporción ocurre que las cuatro monedas muestran cara. O sea, lanzo 4 monedas y apunto si todas han salido cara; las lanzo otra vez y vuelvo a apuntar; las lanzo otra vez y vuelvo a apuntar; y así 10.000 veces.</p>
<div id="cell-generacion-lanzamientos-monedas" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">total_runs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb2-2">n_all_heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(total_runs):</span>
<span id="cb2-5">    heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.random(size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Si &lt;0.5, cara; si no, cruz</span></span>
<span id="cb2-7">    heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb2-8">    n_heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> heads.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb2-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> n_heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>:</span>
<span id="cb2-10">        n_all_heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">n_all_heads <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_runs</span></code></pre></div>
<div id="generacion-lanzamientos-monedas" class="cell-output cell-output-display" data-execution_count="2">
<pre><code>0.0629</code></pre>
</div>
</div>
</section>
<section id="algo-de-visualización" class="level2">
<h2 class="anchored" data-anchor-id="algo-de-visualización">Algo de visualización</h2>
<p>En una moneda la probabilidad de obtener cara es 0.5, pero puedes tener una moneda trucada con una probabilidad diferente (¿puedes?).</p>
<p>Vamos a ver cómo se distribuye el obtener cara en distintos casos. El ejemplo ahora consiste en lanzar una moneda 100 veces, y en esas 100 veces veo cuántas caras he obtenido. Así veré cómo de esperable es obtener muy pocas caras o muchas caras, en función de cuán trucada esté la moneda.</p>
<div id="function-lanzamientos" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> visualizacion_experimentos(probabilidad, lanzamientos, total_experimentos):</span>
<span id="cb4-2">    caras_obtenidas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.empty(total_experimentos)</span>
<span id="cb4-3"></span>
<span id="cb4-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(total_experimentos):</span>
<span id="cb4-5">        caras_obtenidas[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.random.random(lanzamientos) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> probabilidad)</span>
<span id="cb4-6">    </span>
<span id="cb4-7">    plt.hist(caras_obtenidas)</span>
<span id="cb4-8">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Caras obtenidas'</span>)</span>
<span id="cb4-9">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Conteo'</span>)</span>
<span id="cb4-10">    plt.title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Lanzamientos por experimento: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lanzamientos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">. Probabilidad: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>probabilidad<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb4-11">    plt.show()</span></code></pre></div>
</div>
<p>En <code>caras_obtenidas</code> tenemos guardado el número de caras que hemos obtenido en cada experimento (cada uno consiste en 100 lanzamientos de una moneda cuya probabilidad de cara es 0.5).</p>
<div id="cell-experimento0.5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">visualizacion_experimentos(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-23-random-numbers/index_files/figure-html/experimento0.5-output-1.png" id="experimento0.5" width="602" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Lo que más peso tiene está en torno a 50 caras (frente a 100 totales). Es raro bajar de 40 o superar 60. Y parece imposible bajar de 30 o superar 70.</p>
<p>Vamos a cambiar la probabilidad:</p>
<div id="cell-experimento0.1" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">visualizacion_experimentos(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-23-random-numbers/index_files/figure-html/experimento0.1-output-1.png" id="experimento0.1" width="602" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-23-random-numbers/</guid>
  <pubDate>Wed, 23 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Quita caracteres raros en tus variables</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-18-quita-caracteres-raros-en-tus-variables/</link>
  <description><![CDATA[ 




<p>La programación está pensada con el alfabeto anglosajón. Cuando tienes datos en español, francés, turco, etc., aunque el alfabeto tiene casi todo en común con el anglosajón, tiene demasiados elementos molestos en algunos casos.</p>
<p>Sin ir más lejos, estas líneas están llenas de tildes (y alguna eñe caerá). En las filas de una columna pueden no molestarte (dependerá del análisis que vayas hacer), pero si tienes que pasar esos valores a nombres de columnas, puede ser muy mala idea que tengas alguna llamada <code>año</code>.</p>
<p>Veamos formas de solucionarlo.</p>
<section id="a-mano" class="level2">
<h2 class="anchored" data-anchor-id="a-mano">A mano</h2>
<p>Forma horrible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">nombres <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Campaña veintitrés"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"C'est très petite"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Alışveriş Arabası Önü Giydirme"</span>)</span>
<span id="cb1-2">nombres <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(nombres, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-3">nombres</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Campaña veintitrés"             "C'est très petite"             
[3] "Alışveriş Arabası Önü Giydirme" "Campaña veintitrés"            
[5] "C'est très petite"              "Alışveriş Arabası Önü Giydirme"</code></pre>
</div>
</div>
<p>Tienes una columna con esos valores. Tienen textos en español, francés y turco. Y repetidos. Quieres adaptarlo a alfabeto anglosajón. Por ejemplo, <code>"campaña"</code> pasará a ser <code>"campana"</code> (habrá niños en el cuerpo de un adulto que se pondrían nerviosos si estuviera la palabra <code>"año"</code> por allí).</p>
<p>Puedes plantear algún <code>replace</code>, pero como intentes hacerlo carácter a carácter, vas a querer dejar tu trabajo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_replace</span>(nombres, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ñ"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Campana veintitrés"             "C'est très petite"             
[3] "Alışveriş Arabası Önü Giydirme" "Campana veintitrés"            
[5] "C'est très petite"              "Alışveriş Arabası Önü Giydirme"</code></pre>
</div>
</div>
<p>Eso puede serte útil si tienes algún maestro que te dijera como cambiar carácter. Pero no tiene sentido que tengas que hacerlo letra a letra (aunque es muy posible que la mejor forma de construir ese maestro es hacerlo letra a letra la primera vez).</p>
</section>
<section id="conversiones" class="level2">
<h2 class="anchored" data-anchor-id="conversiones"><em>Conversiones</em></h2>
<p>No sé cómo llamar a esto, pero hay un par de funciones que pueden ayudarte… en cierto modo.</p>
<p>Matizo: te pueden quitar los caracteres raros, pero no va a ser suficiente para que los textos te sirvan como nombres de columnas.</p>
<p>Ten en cuenta que los nombres de columnas deberían ser en minúsculas y con barras bajas (o quizá con mayúscula la primera letra de cada palabra, si barras), no solo sin tildes ni caracteres raros.</p>
<p>Pero vamos a ver cómo queda.</p>
<p>En R base tienes la función <code>iconv()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">iconv</span>(nombres, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ASCII//TRANSLIT"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Campana veintitres"             "C'est tres petite"             
[3] "Alisveris Arabasi Onu Giydirme" "Campana veintitres"            
[5] "C'est tres petite"              "Alisveris Arabasi Onu Giydirme"</code></pre>
</div>
</div>
<p>No está mal, que me ha incluso simplificado las íes turcas. Pero esto sigue sin valerme a mí.</p>
<p>Si te vale a ti, una alternativa es:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">stringi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stri_trans_general</span>(nombres, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latin-ascii"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Campana veintitres"             "C'est tres petite"             
[3] "Alisveris Arabasi Onu Giydirme" "Campana veintitres"            
[5] "C'est tres petite"              "Alisveris Arabasi Onu Giydirme"</code></pre>
</div>
</div>
<p>Pero:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">microbenchmark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb9-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">iconv</span>(nombres, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ASCII//TRANSLIT"</span>), </span>
<span id="cb9-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringi =</span> stringi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stri_trans_general</span>(nombres, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latin-ascii"</span>)</span>
<span id="cb9-4">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
    expr   min     lq    mean median     uq    max neval
    base  48.8  92.40  93.886   97.7 107.70  138.3   100
 stringi 340.3 422.45 708.301  868.9 880.25 1161.3   100</code></pre>
</div>
</div>
</section>
<section id="mi-solución" class="level2">
<h2 class="anchored" data-anchor-id="mi-solución">Mi solución</h2>
<p>Insisto que lo que quiero no es solo unificar caracteres, cosa que podría ser útil en algún proyecto de procesamiento de lenguaje natural, sino convertir esos textos a algo útil como nombres de columnas de una tabla (con sus minúsculas, sus barras bajas en lugar de espacios, etc).</p>
<p>Para esto me gusta la librería <strong>janitor</strong>. La función con la que la conocí es <code>clean_names()</code>.</p>
<p>Recuerda que los nombres de columnas del data frame <code>iris</code> son Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species. Pero:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(janitor)</span>
<span id="cb11-2">iris <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sepal_length" "sepal_width"  "petal_length" "petal_width"  "species"     </code></pre>
</div>
</div>
<p>Esta librería tiene la función <code>make_clean_names()</code>, que actúa sobre vectores.</p>
<p>Pero ten en cuenta una cosa: que su utilidad principal es para nombres de columnas, y <strong>en una tabla nunca debería haber dos columnas con el mismo nombre</strong>, así que evita duplicados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">make_clean_names</span>(nombres)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "campana_veintitres"               "cest_tres_petite"                
[3] "alisveris_arabasi_onu_giydirme"   "campana_veintitres_2"            
[5] "cest_tres_petite_2"               "alisveris_arabasi_onu_giydirme_2"</code></pre>
</div>
</div>
<p>Tú puedes no querer eso. Pero hay un argumento que te soluciona el problema:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">make_clean_names</span>(nombres, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">allow_dupes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "campana_veintitres"             "cest_tres_petite"              
[3] "alisveris_arabasi_onu_giydirme" "campana_veintitres"            
[5] "cest_tres_petite"               "alisveris_arabasi_onu_giydirme"</code></pre>
</div>
</div>
</section>
<section id="python" class="level2">
<h2 class="anchored" data-anchor-id="python">Python</h2>
<p>En algún momento, haré esto en Python.</p>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-18-quita-caracteres-raros-en-tus-variables/</guid>
  <pubDate>Fri, 18 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Ejemplo de regresión múltiple con Python</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-06-regresion-multiple-python/</link>
  <description><![CDATA[ 




<p>Aquí sigo un ejercicio de regresión lineal con Python del libro <em>Introduction to Statistical Learning with Python.</em></p>
<section id="regresión-simple" class="level2">
<h2 class="anchored" data-anchor-id="regresión-simple">Regresión simple</h2>
<section id="código-del-ajuste-del-modelo" class="level3">
<h3 class="anchored" data-anchor-id="código-del-ajuste-del-modelo">Código del ajuste del modelo</h3>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> subplots</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sm</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.stats.outliers_influence <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> variance_inflation_factor <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> VIF</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.stats.anova <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> anova_lm</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ISLP <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_data</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> ISLP.models <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (ModelSpec <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> MS, summarize, poly)</span></code></pre></div>
</div>
<div id="cell-load-data" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">boston <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> load_data(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Boston'</span>)</span>
<span id="cb2-2">boston.head()</span></code></pre></div>
<div id="load-data" class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">crim</th>
<th data-quarto-table-cell-role="th">zn</th>
<th data-quarto-table-cell-role="th">indus</th>
<th data-quarto-table-cell-role="th">chas</th>
<th data-quarto-table-cell-role="th">nox</th>
<th data-quarto-table-cell-role="th">rm</th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">dis</th>
<th data-quarto-table-cell-role="th">rad</th>
<th data-quarto-table-cell-role="th">tax</th>
<th data-quarto-table-cell-role="th">ptratio</th>
<th data-quarto-table-cell-role="th">lstat</th>
<th data-quarto-table-cell-role="th">medv</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.00632</td>
<td>18.0</td>
<td>2.31</td>
<td>0</td>
<td>0.538</td>
<td>6.575</td>
<td>65.2</td>
<td>4.0900</td>
<td>1</td>
<td>296</td>
<td>15.3</td>
<td>4.98</td>
<td>24.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.02731</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>6.421</td>
<td>78.9</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>9.14</td>
<td>21.6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.02729</td>
<td>0.0</td>
<td>7.07</td>
<td>0</td>
<td>0.469</td>
<td>7.185</td>
<td>61.1</td>
<td>4.9671</td>
<td>2</td>
<td>242</td>
<td>17.8</td>
<td>4.03</td>
<td>34.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.03237</td>
<td>0.0</td>
<td>2.18</td>
<td>0</td>
<td>0.458</td>
<td>6.998</td>
<td>45.8</td>
<td>6.0622</td>
<td>3</td>
<td>222</td>
<td>18.7</td>
<td>2.94</td>
<td>33.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.06905</td>
<td>0.0</td>
<td>2.18</td>
<td>0</td>
<td>0.458</td>
<td>7.147</td>
<td>54.2</td>
<td>6.0622</td>
<td>3</td>
<td>222</td>
<td>18.7</td>
<td>5.33</td>
<td>36.2</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Estos datos son un clásico, que incluso han tenido ya <em>haters</em> por no sé qué variable que hace al conjunto racista. Pero yo voy a seguir con el ejemplo de ISLP porque no me quiero complicar ahora.</p>
<p>El libro ajusta una regresión lineal de <code>'medv'</code> frente a <code>'lstat'</code>. Por supuesto, ni idea de qué es cada una. Pero solo quier practicar código Python; el resultado nos da igual.</p>
<div id="cell-datos" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'intercept'</span>: np.ones(boston.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]),</span>
<span id="cb3-2">                  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>: boston[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>]})</span>
<span id="cb3-3"></span>
<span id="cb3-4">X.head()                  </span></code></pre></div>
<div id="datos" class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">intercept</th>
<th data-quarto-table-cell-role="th">lstat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>4.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>9.14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>4.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>2.94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>5.33</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En <strong>statsmodels</strong> el <em>intercept</em> no se incluye por defecto y es el usuario quien tiene que incluirlo.</p>
<div id="cell-ols1" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> boston[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'medv'</span>]</span>
<span id="cb4-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.OLS(y, X)</span>
<span id="cb4-3">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.fit()</span>
<span id="cb4-4">results.summary()</span></code></pre></div>
<div id="ols1" class="cell-output cell-output-display" data-execution_count="4">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>medv</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.544</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.543</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>601.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Mon, 14 Oct 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>5.08e-88</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>11:25:22</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-1641.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>506</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>3287.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>504</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>3295.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>1</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">intercept</td>
<td>34.5538</td>
<td>0.563</td>
<td>61.415</td>
<td>0.000</td>
<td>33.448</td>
<td>35.659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lstat</td>
<td>-0.9500</td>
<td>0.039</td>
<td>-24.528</td>
<td>0.000</td>
<td>-1.026</td>
<td>-0.874</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>137.043</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>0.892</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>291.373</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>1.453</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>5.36e-64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>5.319</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>29.7</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>
<p>Una forma más generalizable de preparar los datos es con la función <code>MS()</code>, que funciona al estilo <code>sklearn</code>. Pero es algo propio del libro así que no sé si le haré mucho caso.</p>
<div id="cell-fit-tranform" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">design <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MS([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>])</span>
<span id="cb5-2">design <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> design.fit(boston)</span>
<span id="cb5-3">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> design.transform(boston)</span>
<span id="cb5-4">X.head()</span></code></pre></div>
<div id="fit-tranform" class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">intercept</th>
<th data-quarto-table-cell-role="th">lstat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>4.98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>9.14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>4.03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.0</td>
<td>2.94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1.0</td>
<td>5.33</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>También se puede acortar con <code>fit_transform()</code>.</p>
<p>A partir del modelo, guardado en <code>results</code>, y un conjunto de datos, puedes obtener predicciones.</p>
<div id="21a25317" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">new_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>]})</span>
<span id="cb6-2">newX <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> design.transform(new_df)</span>
<span id="cb6-3">newX</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">intercept</th>
<th data-quarto-table-cell-role="th">lstat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.0</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.0</td>
<td>15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Y ahora predices:</p>
<div id="cell-predicciones" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">new_predictions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> results.get_prediction(newX)</span>
<span id="cb7-2">new_predictions.conf_int(alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>)</span></code></pre></div>
<div id="predicciones" class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([[29.7781697 , 29.82901852],
       [25.03485131, 25.07184337],
       [20.28485052, 20.32135063]])</code></pre>
</div>
</div>
</section>
<section id="gráfico" class="level3">
<h3 class="anchored" data-anchor-id="gráfico">Gráfico</h3>
<p>El primer gráfico muestra la regresión calculada.</p>
<div id="cell-plot-regression" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> abline(ax, b, m, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs):</span>
<span id="cb9-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"Add a line with slope m and intercept b to ax"</span></span>
<span id="cb9-3">    xlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ax.get_xlim()</span>
<span id="cb9-4">    ylim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b, m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> xlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b]</span>
<span id="cb9-5">    ax.plot(xlim, ylim, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>args, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>kwargs)</span>
<span id="cb9-6"></span>
<span id="cb9-7">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> boston.plot.scatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'medv'</span>)</span>
<span id="cb9-8">abline(ax, </span>
<span id="cb9-9">       results.params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb9-10">       results.params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb9-11">       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r--'</span>, </span>
<span id="cb9-12">       linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-06-regresion-multiple-python/index_files/figure-html/plot-regression-output-1.png" id="plot-regression" width="585" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El segundo gráfico compara los residuos frente a los valores ajustados.</p>
<p>Parece que los valores ajustados más pequeños están asociados a residuos negativos y altos. En valores más altos de ajuste, hay residuos tanto positivos como negativos, pero se concentran muchos más en casos negativos.</p>
<div id="cell-residuals" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb10-2">ax.scatter(results.fittedvalues, results.resid)</span>
<span id="cb10-3">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fitted value'</span>)</span>
<span id="cb10-4">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Residual'</span>)</span>
<span id="cb10-5">ax.axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, ls<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-06-regresion-multiple-python/index_files/figure-html/residuals-output-1.png" id="residuals" width="670" height="651" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>El <em>leverage</em> es una métrica que indica cuánto se aleja un punto del centroide de toda la nube de puntos. Puntos muy alejados tendrán una mayor influencia en el cálculo del coeficiente que puntos cercanos.</p>
<p>El gráfico muestra el <em>leverage</em> contra el índice del punto, lo que ayuda a identificar puntos más influyentes (en el caso de una serie temporal, se podría ver como una evolución).</p>
<div id="plot-levarage" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">infl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> results.get_influence()</span>
<span id="cb11-2">ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>))[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb11-3">ax.scatter(np.arange(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), infl.hat_matrix_diag)</span>
<span id="cb11-4">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Index'</span>)</span>
<span id="cb11-5">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Leverage'</span>)</span>
<span id="cb11-6">np.argmax(infl.hat_matrix_diag)</span></code></pre></div>
<div id="plot-levarage-1" class="cell-output cell-output-display" data-execution_count="10">
<pre><code>374</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-06-regresion-multiple-python/index_files/figure-html/plot-levarage-output-2.png" id="plot-levarage-2" width="680" height="651" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="regresión-múltiple" class="level2">
<h2 class="anchored" data-anchor-id="regresión-múltiple">Regresión múltiple</h2>
<p>Ahora enfrentan <code>'medv'</code> a <code>'lstat'</code> y <code>'age'</code>.</p>
<div id="cell-multiple" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MS([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lstat'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'age'</span>]).fit_transform(boston)</span>
<span id="cb13-2">model1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.OLS(y, X)</span>
<span id="cb13-3">results1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model1.fit()</span>
<span id="cb13-4">results1.summary()</span></code></pre></div>
<div id="multiple" class="cell-output cell-output-display" data-execution_count="11">
<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>OLS Regression Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>medv</td>
<td data-quarto-table-cell-role="th">R-squared:</td>
<td>0.551</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>OLS</td>
<td data-quarto-table-cell-role="th">Adj. R-squared:</td>
<td>0.549</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Method:</td>
<td>Least Squares</td>
<td data-quarto-table-cell-role="th">F-statistic:</td>
<td>309.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Mon, 14 Oct 2024</td>
<td data-quarto-table-cell-role="th">Prob (F-statistic):</td>
<td>2.98e-88</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Time:</td>
<td>11:25:23</td>
<td data-quarto-table-cell-role="th">Log-Likelihood:</td>
<td>-1637.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>506</td>
<td data-quarto-table-cell-role="th">AIC:</td>
<td>3281.</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Df Residuals:</td>
<td>503</td>
<td data-quarto-table-cell-role="th">BIC:</td>
<td>3294.</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Df Model:</td>
<td>2</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>nonrobust</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">t</td>
<td data-quarto-table-cell-role="th">P&gt;|t|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">intercept</td>
<td>33.2228</td>
<td>0.731</td>
<td>45.458</td>
<td>0.000</td>
<td>31.787</td>
<td>34.659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lstat</td>
<td>-1.0321</td>
<td>0.048</td>
<td>-21.416</td>
<td>0.000</td>
<td>-1.127</td>
<td>-0.937</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">age</td>
<td>0.0345</td>
<td>0.012</td>
<td>2.826</td>
<td>0.005</td>
<td>0.011</td>
<td>0.059</td>
</tr>
</tbody>
</table>


<table class="simpletable caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Omnibus:</td>
<td>124.288</td>
<td data-quarto-table-cell-role="th">Durbin-Watson:</td>
<td>0.945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Omnibus):</td>
<td>0.000</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>244.026</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Skew:</td>
<td>1.362</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>1.02e-53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>5.038</td>
<td data-quarto-table-cell-role="th">Cond. No.</td>
<td>201.</td>
</tr>
</tbody>
</table>
<br><br>Notes:<br>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</div>
</div>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-06-regresion-multiple-python/</guid>
  <pubDate>Sun, 06 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Procesos ergódicos</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-10-04-ergodicidad/</link>
  <description><![CDATA[ 




<p><a href="https://www.datanalytics.com/2024/10/03/ergodicidad-utilitarismo/">Leo a Gil Bellosta</a> sobre ergocidad y he querido plantear lo que comenta.</p>
<p>El define la ergodicidad mucho mejor de lo que lo podría hacer yo, salvo que lo copiara. Pero para copiarlo, mejor ve a su web.</p>
<p>Planteo aquí el código de su ejemplo.</p>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<section id="lanzamiento-de-una-moneda" class="level2">
<h2 class="anchored" data-anchor-id="lanzamiento-de-una-moneda">Lanzamiento de una moneda</h2>
<div id="params" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">n_individuos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-2">n_veces <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span></code></pre></div>
</div>
<p>Tienes a <code>python n_individuos</code> que lanzan una moneda al aire <code>python n_veces</code> cada uno. Eso hace un total de <code>python n_individuos * n_veces</code> lanzamientos, en los que la probablidad teórica de obtener cara (resultado igual a 1 en este caso) es <img src="https://latex.codecogs.com/png.latex?0,5">.</p>
<div id="cell-sim-lanzamientos" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb3-2">lanzamientos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_individuos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> n_veces)</span>
<span id="cb3-3">lanzamientos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lanzamientos.reshape(n_individuos, n_veces)</span>
<span id="cb3-4">lanzamientos.shape</span></code></pre></div>
<div id="sim-lanzamientos" class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(100, 1000)</code></pre>
</div>
</div>
<p>Este es un proceso estocástico ergódico porque:</p>
<ul>
<li>Para cualquier individuo <img src="https://latex.codecogs.com/png.latex?i">, la probabilidad de obtener cara en todos sus lanzamientos es 0,5, y</li>
<li>para cualquier lanzamiento <img src="https://latex.codecogs.com/png.latex?k">, la probabilidad de obtener cara entre los <img src="https://latex.codecogs.com/png.latex?k">-ésimos lanzamientos de todos los individuos es <img src="https://latex.codecogs.com/png.latex?0,5">.</li>
</ul>
<p>Por ejemplo, la probabilidad de obtener cara para el individuo 2 (el tercero, porque esto es Python y piensan raro) es:</p>
<div id="cell-individuo2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">np.mean(lanzamientos[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, :])</span></code></pre></div>
<div id="individuo2" class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.494</code></pre>
</div>
</div>
<p>A su vez, la probabilidad de que obtengan cara entre todos los individuos en el lanzamiento 50 (el 51 xD) es:</p>
<div id="cell-lanzamiento50" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">np.mean(lanzamientos[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>])</span></code></pre></div>
<div id="lanzamiento50" class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0.53</code></pre>
</div>
</div>
</section>
<section id="ejemplo-de-proceso-no-ergódico" class="level2">
<h2 class="anchored" data-anchor-id="ejemplo-de-proceso-no-ergódico">Ejemplo de proceso no ergódico</h2>
<p>Supón ahora este proceso:</p>
<ol type="1">
<li>Partes de un capital de 1.</li>
<li>Tiras una moneda al aire.</li>
<li>Si sale cara, multiplicas el capital por 1,5; si sale cruz, por 0,6</li>
<li>Ve al paso 2.</li>
</ol>
<p>La simulación de lanzamientos de monedas con sus resultados <img src="https://latex.codecogs.com/png.latex?1,5"> y <img src="https://latex.codecogs.com/png.latex?0,6"> se puede hacer así:</p>
<div id="multiplicadores" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">multiplicadores_capital <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.choice([<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>], size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n_individuos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> n_veces)</span>
<span id="cb9-2">multiplicadores_capital <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> multiplicadores_capital.reshape(n_individuos, n_veces)</span></code></pre></div>
</div>
<p>Y la evolución del capital se calcula así:</p>
<div id="capital-evolution" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">capitales <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> multiplicadores_capital.cumprod(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
</div>
<p>El capital de cada individuo (<code>python n_individuos</code>) empezaba en 1, por lo que el capital medio por individuo era de 1. Tras el primer lanzamiento, el capital medio queda en:</p>
<div id="cell-capital1" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">capitales[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].mean()</span></code></pre></div>
<div id="capital1" class="cell-output cell-output-display" data-execution_count="8">
<pre><code>1.0499999999999998</code></pre>
</div>
</div>
<p>Ten en cuenta que la media teórica sería <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1,50%20+%200,60%7D%7B2%7D%20=%201,05">.</p>
<p>La evolución de capitales medios:</p>
<div id="cell-capital-societario" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute mean per column on numpy array capitales</span></span>
<span id="cb13-2">evolucion_capital_medio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> capitales.mean(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-3"></span>
<span id="cb13-4">plt.plot(evolucion_capital_medio[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, ], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#800080'</span>)</span>
<span id="cb13-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Tiempo'</span>)</span>
<span id="cb13-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Capital medio'</span>)</span>
<span id="cb13-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Evolución del capital medio'</span>)</span>
<span id="cb13-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-10-04-ergodicidad/index_files/figure-html/capital-societario-output-1.png" id="capital-societario" width="585" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Si pongo de límite hasta la tirada 100, el capital medio ha crecido:</p>
<div id="cell-tirada100" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">n_tirada <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-2">evolucion_capital_medio[n_tirada, ]</span></code></pre></div>
<div id="tirada100" class="cell-output cell-output-display" data-execution_count="10">
<pre><code>16.859029246380643</code></pre>
</div>
</div>
<p>Sin embargo, solo un 11% de los individuos ha visto su capital crecer:</p>
<div id="cell-tirada100-2" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">(capitales[:, n_tirada] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div id="tirada100-2" class="cell-output cell-output-display" data-execution_count="11">
<pre><code>11</code></pre>
</div>
</div>
<p>En un proceso no ergódico (¿cuántos hay así en una sociedad occidental?), puedes ver crecimiento global, pero solo de unos pocos.</p>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-10-04-ergodicidad/</guid>
  <pubDate>Fri, 04 Oct 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Introducción práctica a Rust</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-09-08-rust/</link>
  <description><![CDATA[ 




<p>No tengo ni idea de Rust, pero he oído que es muy rápido y gestiona la RAM de manera más automática que C++. C++ es fácil de aprovechar con R para utilizar su velocidad pero me tienta probar cosas nuevas.</p>
<p>Para usar R y Rust <a href="https://extendr.github.io/rextendr/">he leído</a> sobre el paquete <strong>rextendr</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rextendr)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create a Rust function</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rust_function</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fn add(a:f64, b:f64) -&gt; f64 { a + b }"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># call it from R</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.7</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.2</code></pre>
</div>
</div>
<p>Ese código básico funciona. Se ha creado un objeto nuevo <code>add</code> que es de tipo <code>function</code>.</p>
<section id="cálculo-de-r2-con-rust" class="level2">
<h2 class="anchored" data-anchor-id="cálculo-de-r2-con-rust">Cálculo de R2 con Rust</h2>
<p>Ahora creo una función que, dados dos vectores, calcule el R2 de ambos, como si uno fuese la predicción que un modelo hace para el otro.</p>
<p><strong>Observación.</strong> Yo no sé Rust pero ChatGPT y otras IIAA sí saben.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">code <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> r<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(</span></span>
<span id="cb3-2"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    #[extendr]</span></span>
<span id="cb3-3"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    fn calcula_r2_rust(actual: &amp;[f64], predicted: &amp;[f64]) -&gt; f64 {</span></span>
<span id="cb3-4"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">     </span></span>
<span id="cb3-5"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        let n = actual.len() as f64;</span></span>
<span id="cb3-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        let mean_actual = actual.iter().sum::&lt;f64&gt;() / n;</span></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        let ssr = actual.iter().enumerate().map(|(i, x)| (x - predicted[i]).powi(2)).sum::&lt;f64&gt;();</span></span>
<span id="cb3-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        let sst = actual.iter().map(|(x)| (x - mean_actual).powi(2)).sum::&lt;f64&gt;();</span></span>
<span id="cb3-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        1.0 - ssr / sst</span></span>
<span id="cb3-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb3-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    }</span></span>
<span id="cb3-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span></span>
<span id="cb3-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rust_source</span>(</span>
<span id="cb3-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code =</span> code, </span>
<span id="cb3-16">)</span></code></pre></div>
</div>
<p>Ahora me invento unos <em>datos</em> y aplico la función.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">nsize <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e6</span></span>
<span id="cb4-2">valor_real <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(nsize, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-3">valor_pred <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> valor_real <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(nsize, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calcula_r2_rust</span>(valor_real, valor_pred)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7492446</code></pre>
</div>
</div>
</section>
<section id="comparativa-de-tiempos-de-ejecución" class="level2">
<h2 class="anchored" data-anchor-id="comparativa-de-tiempos-de-ejecución">Comparativa de tiempos de ejecución</h2>
<p>Creo una función para calcular eso mismo con R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">calcula_r2_r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(actual, pred) {</span>
<span id="cb6-2">    numerador <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((actual <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> pred) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-3">    mean_actual <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(actual)</span>
<span id="cb6-4">    denominador <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>((actual <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_actual) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-5"></span>
<span id="cb6-6">    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> numerador <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> denominador</span>
<span id="cb6-7">}</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calcula_r2_r</span>(valor_real, valor_pred)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7492446</code></pre>
</div>
</div>
<p>Y ahora lo divertido, comparo tiempos. Que, por supuesto, no tienen ningún sentido.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">microbenchmark<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">microbenchmark</span>(</span>
<span id="cb8-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rust =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calcula_r2_rust</span>(valor_real, valor_pred), </span>
<span id="cb8-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">calcula_r2_r</span>(valor_real, valor_pred)</span>
<span id="cb8-4">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: milliseconds
 expr      min       lq     mean   median       uq      max neval
 rust 60.86050 62.41938 67.36861 64.71865 72.43868 86.67186   100
    r 16.77276 17.47662 24.79657 23.71143 30.52387 50.23770   100</code></pre>
</div>
</div>
<p>Ya, otro día comparo con Rcpp y lo llevo a Python.</p>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-09-08-rust/</guid>
  <pubDate>Sun, 08 Sep 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Más sobre evaluación de expresiones en R</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-08-23-sin-comillas/</link>
  <description><![CDATA[ 




<section id="orden-de-operaciones" class="level2">
<h2 class="anchored" data-anchor-id="orden-de-operaciones">Orden de operaciones</h2>
<p>En R puedes evaluar una expresión a partir de texto (o sea, como si la expresión fuera un objeto de tipo <code>character</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-2">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb1-3"></span>
<span id="cb1-4">expr1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a + b"</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> expr1))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>Esa expresión es la operación <img src="https://latex.codecogs.com/png.latex?a%20+%20b">. También podrías tener la operación <img src="https://latex.codecogs.com/png.latex?2%5Ccdot%20a%20-%203%20%5Ccdot%20b">, que podrías guardar en un objeto <code>character</code> de forma parecida a la anterior.</p>
<p>De manera intuitiva, si quieres <em>juntar</em> o <em>concatenar</em> las dos operaciones mediante una división, ¿qué operación te sale?</p>
<p>A mí me sale esta: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Ba%20+%20b%7D%7B2%5Ccdot%20a%20-%203%20%5Ccdot%20b%7D">, que no es la misma que <img src="https://latex.codecogs.com/png.latex?a%20+%20%5Cfrac%7Bb%7D%7B2%5Ccdot%20a%7D%20-%203%20%5Ccdot%20b">.</p>
<p>Pero si no tienes cuidado, para R sí lo será:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">expr2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2 * a - 3 * b"</span></span>
<span id="cb3-2"></span>
<span id="cb3-3">expr_division <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(expr1, expr2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" / "</span>)</span>
<span id="cb3-4">expr_division</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a + b / 2 * a - 3 * b"</code></pre>
</div>
</div>
<p>El resultado de esa operación es -6.5, que no es lo mismo que:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">(a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5714286</code></pre>
</div>
</div>
</section>
<section id="solución-con-rlang" class="level1">
<h1>Solución con rlang</h1>
<p>Si trabajas con operaciones puedes hacer esto sin gestionar los paréntesis.</p>
<p>Tampoco te voy a decir que sea fácil, la verdad, pero me parece más práctico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rlang)</span>
<span id="cb7-2">expr1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expr</span>(a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b)</span>
<span id="cb7-3">expr2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expr</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b)</span>
<span id="cb7-4">expr_division  <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expr</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>expr1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!!</span>expr2) </span>
<span id="cb7-5">expr_division</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(a + b)/(2 * a - 3 * b)</code></pre>
</div>
</div>
<p>Ahora evalúas la expresión:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval_tidy</span>(expr_division)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5714286</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-08-23-sin-comillas/</guid>
  <pubDate>Fri, 23 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Evaluación de expresiones en R</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-08-17-evaluacion-expresiones/</link>
  <description><![CDATA[ 




<p>Levanta la mano si a ti también te gusta concatenar caracteres con <code>+</code> como en Python.</p>
<p>Me refiero a que en Python puedes hacer <code>'Hola ' + ' Leo'</code> pero en R no.</p>
<p>¿O sí?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hola, puedo "</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"concatenar"</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hola, puedo concatenar"</code></pre>
</div>
</div>
<p>Pero:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<section id="justificación-de-quosures" class="level2">
<h2 class="anchored" data-anchor-id="justificación-de-quosures">Justificación de <code>quosures</code></h2>
<p>La idea detrás de funciones como <code>base::subset()</code> o <code>dplyr::mutate()</code> es que puedes escribir operaciones dentro de data frames haciendo referencia directamente a las columnas, sin usar la sintaxis <code>df$columna</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rlang)</span>
<span id="cb5-2">opera <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data, entrada) {</span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval_tidy</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enexpr</span>(entrada), data)</span>
<span id="cb5-4">}</span>
<span id="cb5-5"></span>
<span id="cb5-6">nuevo_calculo <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opera</span>(iris, Sepal.Length <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Sepal.Width)</span>
<span id="cb5-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(nuevo_calculo)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.6 7.9 7.9 7.7 8.6 9.3</code></pre>
</div>
</div>
<p>El inconveniente es que <code>enexpr()</code> puede no ser suficiente porque no tiene en cuenta información del entorno.</p>
<p>Por ejemplo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb7-2">factor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb7-3"></span>
<span id="cb7-4">opera2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data, entrada) {</span>
<span id="cb7-5">  factor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval_tidy</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enexpr</span>(entrada), data)</span>
<span id="cb7-7">}</span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Con enquo no sabes cuál es el entorno original de la variable</span></span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opera2</span>(df, col1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> factor)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50 60 70</code></pre>
</div>
</div>
<p>Una solución que se te puede ocurrir es: <em>no pongas en la expresión variables que estén definidas en la función</em>. Ya, ¿y si no sabes lo que hay en la función? ¿Y si el código es tan largo que no te da para revisarlo?</p>
<p>Pues lo arreglas con <code>enquo()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>))</span>
<span id="cb9-2">factor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb9-3"></span>
<span id="cb9-4">opera3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data, entrada) {</span>
<span id="cb9-5">  factor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">eval_tidy</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enquo</span>(entrada), data)</span>
<span id="cb9-7">}</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Con enquo usas el entorno donde se definió la variable original</span></span>
<span id="cb9-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">opera3</span>(df, col1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> factor)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10 12 14</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-08-17-evaluacion-expresiones/</guid>
  <pubDate>Sat, 17 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Estadísticos en regresión lineal por variable</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/</link>
  <description><![CDATA[ 




<section id="intro-y-datos" class="level2">
<h2 class="anchored" data-anchor-id="intro-y-datos">Intro y datos</h2>
<p>Voy a revisar aquí cómo se calcula el p-valor de una variable en una regresión lineal, porque es una cosa que siempre se me olvida. Y quiero tenerlo a mano.</p>
<p>Además, lo voy a hacer en Python porque me gusta sufrir.</p>
<div id="libs" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sm</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<p>Me invento unos datos que me sirvan para ajustar una regresión lineal:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay%20=%20%5Cbeta_0%20+%20%5Cbeta_1%20%5Ccdot%20x%20+%20%5Cvarepsilon,%0A"></p>
<p>donde <img src="https://latex.codecogs.com/png.latex?%5Cbeta_0%20=%20-%205">, <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1%20=%203"> y <img src="https://latex.codecogs.com/png.latex?x%20~%20%5Cmbox%7BPoisson(12)%7D"> y <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon%20%5Csim%20%5Ccal%7BN%7D(0,%2010)">.</p>
<div id="generate-data" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">nobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb2-2">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.poisson(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, nobs)</span>
<span id="cb2-3">noise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, nobs)</span>
<span id="cb2-4"></span>
<span id="cb2-5">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> noise</span></code></pre></div>
</div>
<p>Ahora ajusto la regresión lineal con <strong>statsmodels</strong>. ¿Se puede hacer con <strong>sklearn</strong>? Pues imagino que sí, pero necesitaré luego acceder a detalles del modelo a los que no sé acceder con sklearn.</p>
<div id="fit-model" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.add_constant(x)</span>
<span id="cb3-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sm.OLS(y, X).fit()</span>
<span id="cb3-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(model.summary())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.527
Model:                            OLS   Adj. R-squared:                  0.527
Method:                 Least Squares   F-statistic:                 1.115e+04
Date:                Mon, 19 Aug 2024   Prob (F-statistic):               0.00
Time:                        23:37:26   Log-Likelihood:                -37190.
No. Observations:               10000   AIC:                         7.438e+04
Df Residuals:                    9998   BIC:                         7.440e+04
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -5.0025      0.357    -14.009      0.000      -5.702      -4.303
x1             3.0140      0.029    105.585      0.000       2.958       3.070
==============================================================================
Omnibus:                        7.083   Durbin-Watson:                   2.023
Prob(Omnibus):                  0.029   Jarque-Bera (JB):                7.775
Skew:                          -0.014   Prob(JB):                       0.0205
Kurtosis:                       3.134   Cond. No.                         45.0
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</code></pre>
</div>
</div>
<p>Para calcular el p-valor de <img src="https://latex.codecogs.com/png.latex?x"> en el modelo necesito el estadístico <img src="https://latex.codecogs.com/png.latex?t">. Para eso necesito, aparte del valor del coeficiente, el error estándar de la variable.</p>
</section>
<section id="error-estándar" class="level2">
<h2 class="anchored" data-anchor-id="error-estándar">Error estándar</h2>
<p>Este error estándar relaciona la varianza de la variable con la varianza de los errores:</p>
<ul>
<li>Si una variable tiene poca varianza y los errores tienen mucha, la variable está aportando poco al modelo.</li>
<li>Si una variable tiene una varianza alta, estará contribuyendo más al modelo.</li>
<li>Si un modelo tiene errores con varianza baja, el error estándar de la variable tenderá a ser bajo.</li>
</ul>
<blockquote class="blockquote">
<p>Cuanto mayor sea el error estándar, menor siginificatividad tendrá la variable. Por lo tanto, con un varianza del error pequeña, más fácil será que la variable aparezca significativa.</p>
</blockquote>
<div id="standard-error" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">standard_error <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(model.resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb5-2">standard_error_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> standard_error <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.sqrt(nobs)  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.std(x)</span></code></pre></div>
</div>
<p>El error estándar de los residuos es 9.975818941126349 y el de la variable es 0.028545857080981202.</p>
<blockquote class="blockquote">
<p>El error estándar del intercept es más lío de calcular e interpretar; la idea intuitiva es que tiene en cuenta la varianza de todas las variables explicativas a la vez.</p>
</blockquote>
<div id="cell-standard-error-int" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">standard_error <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> nobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.mean(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.mean(x)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
<div id="standard-error-int" class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0.3570820876215312</code></pre>
</div>
</div>
</section>
<section id="estadístico-t" class="level2">
<h2 class="anchored" data-anchor-id="estadístico-t">Estadístico <img src="https://latex.codecogs.com/png.latex?t"></h2>
<p>El estadístico <img src="https://latex.codecogs.com/png.latex?t"> se calcula como</p>
<p><img src="https://latex.codecogs.com/png.latex?%0At%20=%20%5Cfrac%7B%5Cmbox%7Bcoef%7D%5C%20x%7D%7B%5Cmbox%7Bstd%20error%7D%5C%20x%7D.%0A"></p>
<ul>
<li>Si la variable tiene un error pequeño, el estadístico crece (eso es bueno para la significatividad de la variable).</li>
<li>A su vez, si el coeficiente es alto (en valor absoluto), entonces también crece.</li>
<li>El estadístico decrece con coeficientes bajos o con errores altos (es decir, la variable parecerá no significativa).</li>
</ul>
<div id="4d9e3c12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># label: t-stat</span></span>
<span id="cb8-2">t_stat_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(model.params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> standard_error_x</span>
<span id="cb8-3">t_stat_x</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>105.58474083439029</code></pre>
</div>
</div>
</section>
<section id="p-valor" class="level2">
<h2 class="anchored" data-anchor-id="p-valor">p-valor</h2>
<p>Ahora hay que ver qué valor es esperable para el estadístico <img src="https://latex.codecogs.com/png.latex?t">.</p>
<p>Pon que trabajas al nivel de confianza del 90%. Hace falta calcular el <img src="https://latex.codecogs.com/png.latex?t"> que deja el 5% a un lado de la distribución, y el que lo deja al otro lado. Como la distribución es simétrica, solo calculo uno:</p>
<div id="8fdabede" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">percentile <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.t.ppf(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, nobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-2">percentile</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>1.6450060485564049</code></pre>
</div>
</div>
<p>Ahora tienes la distribución de <img src="https://latex.codecogs.com/png.latex?t">. Si <img src="https://latex.codecogs.com/png.latex?t"> cae en el área sombreada (el 10% extremo) entonces la probabilidad de observar tus datos en el supuesto de que la variable no sea significativa (<img src="https://latex.codecogs.com/png.latex?H_0"> o <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1%20=%200">) es menor de 0,10.</p>
<div id="cell-t-distribution" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb12-2">yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.t.pdf(xx, nobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb12-3">plt.plot(xx, yy, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#800080'</span>)</span>
<span id="cb12-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot the t distribution and fill the 5% outside </span></span>
<span id="cb12-5">plt.fill_between(xx, yy, where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>percentile) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> percentile), alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#800080'</span>)</span>
<span id="cb12-6">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribución de t"</span>)</span>
<span id="cb12-7">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/index_files/figure-html/t-distribution-output-1.png" id="t-distribution" width="579" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Concretamente, la probabilidad para el estadístico <img src="https://latex.codecogs.com/png.latex?t"> que has obtenido es muy muy baja.</p>
<div id="0d1b6ed0" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># p value for coefficient, extracted from</span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># t distribution</span></span>
<span id="cb13-3">stats.t.sf(t_stat_x, nobs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.0</code></pre>
</div>
</div>
</section>
<section id="idea-intuitiva" class="level2">
<h2 class="anchored" data-anchor-id="idea-intuitiva">Idea intuitiva</h2>
<p>Lo que estás haciendo con esto es calcular la probabilidad de obtener los datos que tienes si asumes que las dos variables no tienen relación.</p>
<p>Imagina que estás midiendo la relación entre el consumo de torreznos (gramos de torreznos semanales) y los niveles de colesterol (ni idea de qué unidad se usa en los análisis).</p>
<p>La forma de pensar con este análisis sería:</p>
<ul>
<li>Asumes que no hay relación</li>
<li>Tienes unos datos de varias personas, con su consumo de torreznos y el nivel de colesterol.</li>
<li>Haces el cálculo de la regresión.</li>
<li>El p-valor es cómo de probables son tus datos.</li>
<li>Si tu p-valor es pequeño, entonces los datos son poco probables en el supuesto de que no haya relación. Así que deduces que sí hay relación.</li>
</ul>
<p><strong>¿Qué quiero decir con que tu p-valor sea pequeño?</strong></p>
<p>Me refiero a que, previamente, habrás definido un umbral. Que tu p-valor sea pequeño significa que está por debajo de ese umbral.</p>
<p>¿Cuál debería ser tu umbral? Normalmente es 0,05. Eso se traduce en que:</p>
<ul>
<li>Si la probabilidad de observar tus datos en el supuesto de que no hay relación (p-valor) es menor de 0,05, entonces es que sí hay relación.</li>
<li>Si la probabilidad (p-valor) es mayor, entonces es que no hay relación.</li>
</ul>
<p>Y te pregunto yo. ¿Cuál debería ser para ti la probabilidad? Por ejemplo, si el p-valor es 0,20, ¿automáticamente concluyes que no hay relación?</p>
<p>¿Por qué?</p>
<p>Si tu p-valor es ese, estarías diciendo que la probabilidad de observar tus datos cuando no hubiera relación real es de un 20%. Quizá en un caso médico tienes que tener cuidado, como con lo del colesterol. ¿Pero qué pasa si estás midiendo la eficacia de una acción empresarial?</p>
</section>
<section id="un-ejemplo-más-extremo" class="level2">
<h2 class="anchored" data-anchor-id="un-ejemplo-más-extremo">Un ejemplo más extremo</h2>
<p>En lugar de utilizar la propia variable <img src="https://latex.codecogs.com/png.latex?x"> para ajustar el modelo, podemos alterar <img src="https://latex.codecogs.com/png.latex?x"> introduciendo ruido en ella. Eso lo haré metiendo ruido en la variable, con media 0 y una desviación típica que variaré en varias pruebas.</p>
<p>Por ahora, la desviación típica del ruido sobre <img src="https://latex.codecogs.com/png.latex?x"> es 1.</p>
<div id="cell-genera-escenario" class="cell" data-execution_count="10">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/index_files/figure-html/genera-escenario-output-1.png" id="genera-escenario" width="579" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Voy a poner mucho más ruido. Fíjate en cuánto decrece el estadístico <img src="https://latex.codecogs.com/png.latex?t"> (y en consecuencia cuánto aumenta el p-valor).</p>
<div id="cell-genera-escenario2" class="cell" data-execution_count="11">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/index_files/figure-html/genera-escenario2-output-1.png" id="genera-escenario2" width="579" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-genera-escenario3" class="cell" data-execution_count="12">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/index_files/figure-html/genera-escenario3-output-1.png" id="genera-escenario3" width="579" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-comprobacion-pvalor" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">stats.t.sf(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5341</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9998</span>)</span></code></pre></div>
<div id="comprobacion-pvalor" class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.29664211233560395</code></pre>
</div>
</div>
<div id="cell-prueba-variables" class="cell" data-execution_count="14">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/index_files/figure-html/prueba-variables-output-1.png" id="prueba-variables" width="586" height="431" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>datos</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-08-16-estadisticos-regresion/</guid>
  <pubDate>Fri, 16 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Encuesta de presupuestos familiares</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-08-09-presupuestos-familiares/</link>
  <description><![CDATA[ 




<section id="datos" class="level2">
<h2 class="anchored" data-anchor-id="datos">Datos</h2>
<p>El INE tiene datos de la Encuesta de Presupuestos Familiares. He descargado un fichero con cantidades consumidas por hogar de algunos productos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-5"></span>
<span id="cb1-6">ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>())</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">df_epf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv2</span>(</span>
<span id="cb2-2">  here<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/25168.csv"</span>),</span>
<span id="cb2-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encoding =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latin1"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grouping_mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimal_mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>),</span>
<span id="cb2-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_col_types =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb2-5">)</span>
<span id="cb2-6"></span>
<span id="cb2-7">df_epf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(df_epf)</span>
<span id="cb2-8"></span>
<span id="cb2-9">df_epf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_epf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">total =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_number</span>(</span>
<span id="cb2-12">      total,</span>
<span id="cb2-13">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">grouping_mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimal_mark =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".."</span>)</span>
<span id="cb2-14">    ),</span>
<span id="cb2-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">periodo =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(periodo) </span>
<span id="cb2-16">  )</span></code></pre></div>
</div>
<p>Quito columnas, cambio nombres, etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df_epf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_epf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>cantidades_medias_consumidas) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">producto =</span> codigos_de_gasto_con_cantidad_fisica</span>
<span id="cb3-5">  )</span></code></pre></div>
</div>
<p>Los nombres de productos tienen un código al principio que me va a molestar casi siempre pero pueden llegar a servirme para hacer algún filtro de categorías.</p>
<p>Así que hago algo horrible: creo una función a la que llamaré todo el rato para limpiar los nombres de productos (en lugar de hacerlo definitivo al principio).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">limpia_nombre <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data) {</span>
<span id="cb4-2">  data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">producto =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(</span>
<span id="cb4-5">        producto, </span>
<span id="cb4-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[0-9]{2}</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.[0-9]</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.[0-9]</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.[0-9]</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">sT</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">s"</span></span>
<span id="cb4-7">      )</span>
<span id="cb4-8">    )</span>
<span id="cb4-9">}</span></code></pre></div>
</div>
</section>
<section id="carnes" class="level2">
<h2 class="anchored" data-anchor-id="carnes">Carnes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">dibuja_evolucion <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(data, titulo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cantidad"</span>) {</span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> periodo, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> total, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> producto)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loess"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cantidad media consumida por hogas (%s)"</span>, titulo), </span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> .y</span>
<span id="cb5-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb5-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb5-12">  )</span>
<span id="cb5-13">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">df_epf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">limpia_nombre</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(producto, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Carne "</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dibuja_evolucion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">titulo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Carnes"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-09-presupuestos-familiares/index_files/figure-html/evolucion-carnes-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bebidas" class="level2">
<h2 class="anchored" data-anchor-id="bebidas">Bebidas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">listado_bebidas <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agua mineral"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bebidas refrescantes"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bebidas energéticas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bebidas isotónicas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Zumos de frutas"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vinos de uva"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cerveza"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cerveza baja en alcohol"</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3">df_epf <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">limpia_nombre</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(producto, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(listado_bebidas, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"|"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dibuja_evolucion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">titulo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bebidas"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-09-presupuestos-familiares/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-08-09-presupuestos-familiares/</guid>
  <pubDate>Fri, 09 Aug 2024 00:00:00 GMT</pubDate>
</item>
<item>
  <title>Mercamadrid</title>
  <dc:creator>Leonardo Hansa</dc:creator>
  <link>https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/</link>
  <description><![CDATA[ 




<section id="lectura-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="lectura-de-datos">Lectura de datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(readr)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-6"></span>
<span id="cb1-7">ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(ggplot2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_light</span>())</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">link_base <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://datos.madrid.es/egob/catalogo/300357-%s-mercamadrid-volumen-precio.csv"</span></span>
<span id="cb2-2">links <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(link_base, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-3"></span>
<span id="cb2-4">df_merca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dfr</span>(links, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(link) {</span>
<span id="cb2-5">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (RCurl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url.exists</span>(link)) {</span>
<span id="cb2-6">    datos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv2</span>(</span>
<span id="cb2-7">      link,</span>
<span id="cb2-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">locale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">locale</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">encoding =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"latin1"</span>),</span>
<span id="cb2-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show_col_types =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb2-10">    )</span>
<span id="cb2-11"></span>
<span id="cb2-12">    datos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(datos)</span>
<span id="cb2-13"></span>
<span id="cb2-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.character</span>(datos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fecha_desde)) {</span>
<span id="cb2-15">      datos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-16">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb2-17">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"precio"</span>),</span>
<span id="cb2-18">          \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_number</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Precio Más Frecuente"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Precio Máximo"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Precio Mínimo"</span>))</span>
<span id="cb2-19">        ))</span>
<span id="cb2-20">    }</span>
<span id="cb2-21"></span>
<span id="cb2-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.character</span>(datos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>kilos)) {</span>
<span id="cb2-23">      datos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-24">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-25">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">parse_number</span>(kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kilos"</span>)</span>
<span id="cb2-26">        )</span>
<span id="cb2-27">    }</span>
<span id="cb2-28"></span>
<span id="cb2-29">    datos <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> datos <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-31">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb2-32">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contains</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fecha"</span>),</span>
<span id="cb2-33">          \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y%m%d"</span>)</span>
<span id="cb2-34">        ), </span>
<span id="cb2-35">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">origen =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(origen)</span>
<span id="cb2-36">      )</span>
<span id="cb2-37"></span>
<span id="cb2-38">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(datos)</span>
<span id="cb2-39">  }</span>
<span id="cb2-40">})</span></code></pre></div>
</div>
<p>df_merca &lt;- select(df_merca, -origen)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">df_merca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>(descripcion_variedad)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 754 × 1
   descripcion_variedad 
   &lt;chr&gt;                
 1 VACUNO CANAL         
 2 VACUNO DESPIECE AÑOJO
 3 VACUNO DESPIECE VACA 
 4 VACUNO CASQUERIA     
 5 VACUNO ELABORADO     
 6 VACUNO PRECOCINADO   
 7 OVINO CANAL          
 8 OVINO DESPIECE       
 9 OVINO CASQUERIA      
10 OVINO ELABORADO      
# ℹ 744 more rows</code></pre>
</div>
</div>
</section>
<section id="vacuno" class="level2">
<h2 class="anchored" data-anchor-id="vacuno">Vacuno</h2>
<p>Hay mil cosas. Voy a ver qué puedo sacar solo del vacuno por ahora.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">df_vacuno <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_merca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(descripcion_variedad, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^VACUNO"</span>))</span></code></pre></div>
</div>
<section id="qué-variedad-de-vacuno-se-vende-más" class="level3">
<h3 class="anchored" data-anchor-id="qué-variedad-de-vacuno-se-vende-más">Qué variedad de vacuno se vende más</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">df_vacuno <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(fecha_desde, descripcion_variedad) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fecha_desde, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> descripcion_variedad))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/index_files/figure-html/evolucion-variedad-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>¿Qué será <code>VACUNO FRESCO</code>?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">df_vacuno_variedades <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_vacuno <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(fecha_desde, descripcion_variedad) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(descripcion_variedad) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos_mes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(kilos) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>())</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_vacuno_variedades) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb7-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(descripcion_variedad, kilos_mes), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> kilos_mes),</span>
<span id="cb7-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#800080"</span></span>
<span id="cb7-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kilos por mes"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() </span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/index_files/figure-html/distribucion-variedad-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">variedades_principales <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_vacuno_variedades <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order_by =</span> kilos_mes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(descripcion_variedad)</span>
<span id="cb8-4"></span>
<span id="cb8-5">df_vacuno <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(descripcion_variedad <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> variedades_principales) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(fecha_desde, descripcion_variedad) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fecha_desde, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> descripcion_variedad))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/index_files/figure-html/evolucion-variedad2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="de-dónde-ha-venido-el-vacuno" class="level3">
<h3 class="anchored" data-anchor-id="de-dónde-ha-venido-el-vacuno">¿De dónde ha venido el vacuno?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">df_variedades_origen <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> df_vacuno <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(descripcion_variedad <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> variedades_principales) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(descripcion_variedad, descripcion_origen) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kilos_mes =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(kilos) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.groups =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"drop"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(descripcion_variedad) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order_by =</span> kilos_mes, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span>
<span id="cb9-8"></span>
<span id="cb9-9">df_vacuno <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">semi_join</span>(</span>
<span id="cb9-11">    df_variedades_origen,</span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"descripcion_variedad"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"descripcion_origen"</span>)</span>
<span id="cb9-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fecha_desde, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> kilos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> descripcion_origen)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>descripcion_variedad, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/index_files/figure-html/origen-vacuno-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>exploraciones</category>
  <guid>https://lhansa.github.io/technical-notebooks/posts/2024-08-05-mercamadrid/</guid>
  <pubDate>Mon, 05 Aug 2024 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
